# TradingAgents-CN é¡¹ç›®æŠ€æœ¯åˆ†ææŠ¥å‘Š

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆåˆ†æ](#2-æŠ€æœ¯æ ˆåˆ†æ)
3. [æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
4. [æ ¸å¿ƒæ¨¡å—åˆ†æ](#4-æ ¸å¿ƒæ¨¡å—åˆ†æ)
5. [å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ](#5-å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ)
6. [æ•°æ®æµä¸å¤„ç†](#6-æ•°æ®æµä¸å¤„ç†)
7. [LLM é›†æˆæ¶æ„](#7-llm-é›†æˆæ¶æ„)
8. [éƒ¨ç½²ä¸è¿ç»´](#8-éƒ¨ç½²ä¸è¿ç»´)
9. [æ€»ç»“ä¸å»ºè®®](#9-æ€»ç»“ä¸å»ºè®®)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

**TradingAgents-CN** æ˜¯ä¸€ä¸ªåŸºäº LangGraph å’Œ LangChain çš„å¤šæ™ºèƒ½ä½“è‚¡ç¥¨åˆ†ææ¡†æ¶ï¼Œé‡‡ç”¨ FastAPI åç«¯ + Vue 3 å‰ç«¯çš„å…¨æ ˆæ¶æ„ã€‚é¡¹ç›®æ˜¯ [TauricResearch/TradingAgents](https://github.com/TauricResearch/TradingAgents) çš„ä¸­æ–‡å¢å¼ºç‰ˆæœ¬ï¼Œä¸“é—¨é¢å‘ A è‚¡/æ¸¯è‚¡/ç¾è‚¡å¸‚åœºã€‚

### 1.2 é¡¹ç›®å®šä½

| å®šä½ | æè¿° |
|------|------|
| **ç›®æ ‡ç”¨æˆ·** | ä¸­æ–‡ AI é‡‘èå­¦ä¹ è€…å’Œç ”ç©¶è€… |
| **ä¸»è¦å¸‚åœº** | A è‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡ |
| **åº”ç”¨åœºæ™¯** | è‚¡ç¥¨ç ”ç©¶ã€ç­–ç•¥å®éªŒã€AI é‡‘èå­¦ä¹  |
| **è®¸å¯è¯** | æ··åˆè®¸å¯è¯ï¼ˆApache 2.0 + å•†ä¸šä¸“æœ‰ï¼‰ |

### 1.3 é¡¹ç›®ç»“æ„

```
TradingAgents-CN/
â”œâ”€â”€ tradingagents/          # æ ¸å¿ƒåˆ†ææ¡†æ¶ï¼ˆå¼€æºï¼‰
â”‚   â”œâ”€â”€ agents/            # å¤šæ™ºèƒ½ä½“å®ç°
â”‚   â”‚   â”œâ”€â”€ analysts/      # åˆ†æå¸ˆå›¢é˜Ÿ
â”‚   â”‚   â”œâ”€â”€ researchers/   # ç ”ç©¶å‘˜å›¢é˜Ÿ
â”‚   â”‚   â”œâ”€â”€ risk_mgmt/     # é£é™©ç®¡ç†å›¢é˜Ÿ
â”‚   â”‚   â”œâ”€â”€ trader/        # äº¤æ˜“å‘˜
â”‚   â”‚   â””â”€â”€ utils/         # æ™ºèƒ½ä½“å·¥å…·
â”‚   â”œâ”€â”€ graph/             # LangGraph çŠ¶æ€å›¾
â”‚   â”œâ”€â”€ dataflows/         # æ•°æ®è·å–ä¸å¤„ç†
â”‚   â”œâ”€â”€ llm_adapters/      # LLM é€‚é…å™¨
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ utils/             # å·¥å…·æ¨¡å—
â”œâ”€â”€ app/                   # FastAPI åç«¯ï¼ˆä¸“æœ‰ï¼‰
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routers/           # API è·¯ç”±
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ worker/            # åå°ä»»åŠ¡
â”œâ”€â”€ frontend/              # Vue 3 å‰ç«¯ï¼ˆä¸“æœ‰ï¼‰
â”‚   â””â”€â”€ src/               # å‰ç«¯æºç 
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â””â”€â”€ main.py               # ç¨‹åºå…¥å£
```

---

## 2. æŠ€æœ¯æ ˆåˆ†æ

### 2.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Python** | 3.10+ | æ ¸å¿ƒè¯­è¨€ |
| **FastAPI** | latest | Web æ¡†æ¶ |
| **LangChain** | latest | LLM æ¡†æ¶ |
| **LangGraph** | latest | çŠ¶æ€å›¾ç¼–æ’ |
| **MongoDB** | latest | æ•°æ®å­˜å‚¨ |
| **Redis** | latest | ç¼“å­˜ä¸ä»»åŠ¡é˜Ÿåˆ— |
| **Uvicorn** | latest | ASGI æœåŠ¡å™¨ |
| **Celery** | latest | å¼‚æ­¥ä»»åŠ¡ |

### 2.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Vue 3** | 3.x | UI æ¡†æ¶ |
| **TypeScript** | 5.x | ç±»å‹å®‰å…¨ |
| **Vite** | 5.x | æ„å»ºå·¥å…· |
| **Element Plus** | latest | UI ç»„ä»¶åº“ |
| **Pinia** | latest | çŠ¶æ€ç®¡ç† |

### 2.3 æ•°æ®æº

| æ•°æ®æº | å¸‚åœº | çŠ¶æ€ |
|--------|------|------|
| **Tushare** | A è‚¡ | æ¨è |
| **AkShare** | A è‚¡/æ¸¯è‚¡ | æ”¯æŒ |
| **BaoStock** | A è‚¡ | æ”¯æŒ |
| **yfinance** | ç¾è‚¡ | æ”¯æŒ |

### 2.4 LLM æä¾›å•†

| æä¾›å•† | é€‚é…å™¨ | æ”¯æŒçŠ¶æ€ |
|--------|--------|----------|
| **Google AI** | ChatGoogleOpenAI | âœ… åŸç”Ÿæ”¯æŒ |
| **é˜¿é‡Œç™¾ç‚¼** | ChatDashScopeOpenAI | âœ… åŸç”Ÿæ”¯æŒ |
| **DeepSeek** | ChatDeepSeek | âœ… åŸç”Ÿæ”¯æŒ |
| **æ™ºè°±AI** | ChatZhipuOpenAI | âœ… åŸç”Ÿæ”¯æŒ |
| **åƒå¸†** | ChatQianfanOpenAI | âœ… åŸç”Ÿæ”¯æŒ |
| **OpenAI** | ChatOpenAI | âœ… å…¼å®¹æ”¯æŒ |
| **Anthropic** | ChatAnthropic | âœ… å…¼å®¹æ”¯æŒ |
| **è‡ªå®šä¹‰** | OpenAICompatibleBase | âœ… é€šç”¨é€‚é…å™¨ |

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (Vue 3 + TS)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»ªè¡¨ç›˜   â”‚ â”‚ è‚¡ç¥¨åˆ†æ â”‚ â”‚ ç­–ç•¥é…ç½® â”‚ â”‚ æŠ¥å‘Šå¯¼å‡º â”‚ â”‚ ç³»ç»Ÿè®¾ç½® â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚            â”‚            â”‚
         â–¼            â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        REST API + WebSocket + SSE                    â”‚
â”‚                     (FastAPI + Uvicorn)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‚¡ç¥¨æœåŠ¡     â”‚    â”‚  åˆ†ææœåŠ¡     â”‚    â”‚  ä»»åŠ¡æœåŠ¡     â”‚
â”‚  StockServiceâ”‚    â”‚AnalysisServiceâ”‚    â”‚ TaskService  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TradingAgentsGraph                         â”‚
â”‚                  (å¤šæ™ºèƒ½ä½“åˆ†ææ ¸å¿ƒæ¡†æ¶)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LangGraph çŠ¶æ€å›¾                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ åˆ†æå¸ˆ    â”‚ â”‚ ç ”ç©¶å‘˜    â”‚ â”‚ äº¤æ˜“å‘˜    â”‚ â”‚é£é™©ç®¡ç†â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ å›¢é˜Ÿ      â”‚ â”‚ å›¢é˜Ÿ      â”‚ â”‚ å†³ç­–      â”‚ â”‚å›¢é˜Ÿ    â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â–¼            â–¼            â–¼            â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  Toolkit (å·¥å…·é›†)                    â”‚    â”‚
â”‚  â”‚  - å¸‚åœºæ•°æ®å·¥å…· - åŸºæœ¬é¢å·¥å…· - æ–°é—»å·¥å…·              â”‚    â”‚
â”‚  â”‚  - ç¤¾äº¤åª’ä½“å·¥å…· - æŠ€æœ¯æŒ‡æ ‡å·¥å…·                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLM Adapters   â”‚ â”‚  Data Sources   â”‚ â”‚  Memory Store  â”‚
â”‚  - Google AI    â”‚ â”‚  - Tushare      â”‚ â”‚  - ChromaDB     â”‚
â”‚  - é˜¿é‡Œç™¾ç‚¼      â”‚ â”‚  - AkShare      â”‚ â”‚  - MongoDB      â”‚
â”‚  - DeepSeek     â”‚ â”‚  - yfinance     â”‚ â”‚                 â”‚
â”‚  - æ™ºè°±AI        â”‚ â”‚                 â”‚ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åˆ†å±‚æ¶æ„

| å±‚çº§ | æ¨¡å— | èŒè´£ |
|------|------|------|
| **è¡¨ç°å±‚** | frontend/ | ç”¨æˆ·ç•Œé¢ã€äº¤äº’é€»è¾‘ |
| **API å±‚** | app/routers/ | è·¯ç”±ã€è®¤è¯ã€è¯·æ±‚å¤„ç† |
| **ä¸šåŠ¡å±‚** | app/services/ | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| **æ™ºèƒ½ä½“å±‚** | tradingagents/agents/ | å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ |
| **ç¼–æ’å±‚** | tradingagents/graph/ | LangGraph çŠ¶æ€å›¾ |
| **æ•°æ®å±‚** | tradingagents/dataflows/ | æ•°æ®è·å–ä¸å¤„ç† |
| **LLM å±‚** | tradingagents/llm_adapters/ | LLM é€‚é…ä¸è°ƒç”¨ |

### 3.3 æ¨¡å—ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        main.py                             â”‚
â”‚                     ç¨‹åºå…¥å£ / ä¾èµ–æ³¨å…¥                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼            â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app/   â”‚ â”‚ trading â”‚ â”‚ config/ â”‚ â”‚ utils/  â”‚ â”‚ data/   â”‚
â”‚         â”‚ â”‚ agents/ â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚           â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚           â”‚           â”‚
                 â–¼           â–¼           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ graph/  â”‚ â”‚dataflowsâ”‚ â”‚llm_     â”‚
            â”‚         â”‚ â”‚         â”‚ â”‚adapters/â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ ¸å¿ƒæ¨¡å—åˆ†æ

### 4.1 å¤šæ™ºèƒ½ä½“æ¶æ„ (tradingagents/agents/)

#### 4.1.1 åˆ†æå¸ˆå›¢é˜Ÿ

| åˆ†æå¸ˆ | æ–‡ä»¶ | èŒè´£ | å·¥å…·é›† |
|--------|------|------|--------|
| **å¸‚åœºåˆ†æå¸ˆ** | market_analyst.py | æŠ€æœ¯åˆ†æã€ä»·æ ¼è¶‹åŠ¿ | ç»Ÿä¸€å¸‚åœºæ•°æ®å·¥å…· |
| **åŸºæœ¬é¢åˆ†æå¸ˆ** | fundamentals_analyst.py | è´¢åŠ¡åˆ†æã€ä¼°å€¼æŒ‡æ ‡ | åŸºæœ¬é¢æ•°æ®å·¥å…· |
| **æ–°é—»åˆ†æå¸ˆ** | news_analyst.py | æ–°é—»èˆ†æƒ…åˆ†æ | æ–°é—»è·å–å·¥å…· |
| **ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ** | social_media_analyst.py | ç¤¾äº¤åª’ä½“æƒ…ç»ª | æƒ…ç»ªåˆ†æå·¥å…· |
| **ä¸­å›½å¸‚åœºåˆ†æå¸ˆ** | china_market_analyst.py | A è‚¡ç‰¹æœ‰åˆ†æ | A è‚¡æ•°æ®å·¥å…· |

#### 4.1.2 ç ”ç©¶å‘˜å›¢é˜Ÿ

| ç ”ç©¶å‘˜ | è§’è‰²å®šä½ |
|--------|----------|
| **çœ‹æ¶¨ç ”ç©¶å‘˜** (Bull Researcher) | å¯»æ‰¾åšå¤šæœºä¼šï¼Œä¹è§‚åˆ†æ |
| **çœ‹è·Œç ”ç©¶å‘˜** (Bear Researcher) | å¯»æ‰¾åšç©ºæœºä¼šï¼Œæ‚²è§‚åˆ†æ |

#### 4.1.3 é£é™©ç®¡ç†å›¢é˜Ÿ

| è§’è‰² | èŒè´£ |
|------|------|
| **æ¿€è¿›é£é™©è¯„ä¼°** (Aggressive) | æ¿€è¿›è§‚ç‚¹ï¼Œè¿½æ±‚é«˜æ”¶ç›Š |
| **ä¿å®ˆé£é™©è¯„ä¼°** (Conservative) | ä¿å®ˆè§‚ç‚¹ï¼Œæ³¨é‡é£é™©æ§åˆ¶ |
| **ä¸­æ€§é£é™©è¯„ä¼°** (Neutral) | ä¸­ç«‹å®¢è§‚ï¼Œå¹³è¡¡é£é™©æ”¶ç›Š |
| **é£é™©ç»ç†** (Risk Judge) | ç»¼åˆä¸‰æ–¹æ„è§ï¼Œåšå‡ºæœ€ç»ˆé£é™©åˆ¤æ–­ |

### 4.2 LangGraph çŠ¶æ€å›¾ (tradingagents/graph/)

#### 4.2.1 æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `trading_graph.py` | ä¸»å›¾ç¼–æ’ï¼ŒLLM åˆ›å»º |
| `propagation.py` | çŠ¶æ€åˆå§‹åŒ–ä¸ä¼ æ’­ |
| `setup.py` | å›¾ç»“æ„è®¾ç½® |
| `conditional_logic.py` | æ¡ä»¶é€»è¾‘æ§åˆ¶ |
| `reflection.py` | åæ€ä¸è®°å¿† |
| `signal_processing.py` | å†³ç­–ä¿¡å·å¤„ç† |

#### 4.2.2 çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       LangGraph çŠ¶æ€æµè½¬                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹çŠ¶æ€ (Initial State)                                             â”‚
â”‚ - company_of_interest                                               â”‚
â”‚ - trade_date                                                        â”‚
â”‚ - messages                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       åˆ†æå¸ˆé˜¶æ®µ                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Market       â”‚  â”‚ Fundamentals â”‚  â”‚ News         â”‚              â”‚
â”‚  â”‚ Analyst      â”‚  â”‚ Analyst      â”‚  â”‚ Analyst      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                  â”‚                  â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                            â–¼                                         â”‚
â”‚                    å·¥å…·è°ƒç”¨ (ToolNode)                               â”‚
â”‚              è·å–å¸‚åœºæ•°æ®ã€åŸºæœ¬é¢ã€æ–°é—»ç­‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æŠ•èµ„è¾©è®ºé˜¶æ®µ                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚ Bull         â”‚  â”‚ Bear         â”‚                                 â”‚
â”‚  â”‚ Researcher   â”‚  â”‚ Researcher   â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚         â”‚                  â”‚                                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                  â–¼                                                   â”‚
â”‚         Research Manager (è£å†³)                                      â”‚
â”‚         ç”Ÿæˆ investment_plan                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       äº¤æ˜“å†³ç­–é˜¶æ®µ                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚              Trader                          â”‚                   â”‚
â”‚  â”‚  åŸºäº investment_plan ç”Ÿæˆæœ€ç»ˆäº¤æ˜“å†³ç­–        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       é£é™©è¯„ä¼°é˜¶æ®µ                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Risky        â”‚  â”‚ Safe         â”‚  â”‚ Neutral      â”‚              â”‚
â”‚  â”‚ Analyst      â”‚  â”‚ Analyst      â”‚  â”‚ Analyst      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                  â”‚                  â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                            â–¼                                         â”‚
â”‚                    Risk Judge (è£å†³)                                 â”‚
â”‚                    ç”Ÿæˆ risk_assessment                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æœ€ç»ˆå†³ç­–                                        â”‚
â”‚  ç»¼åˆ investment_plan å’Œ risk_assessment ç”Ÿæˆ                        â”‚
â”‚  final_trade_decision                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ•°æ®æµå¤„ç† (tradingagents/dataflows/)

#### 4.3.1 ç»Ÿä¸€æ•°æ®æ¥å£

```python
# ç»Ÿä¸€æ¥å£è®¾è®¡
class DataInterface:
    """ç»Ÿä¸€æ•°æ®æ¥å£ï¼Œè‡ªåŠ¨è¯†åˆ«è‚¡ç¥¨ç±»å‹"""

    def get_stock_market_data_unified(ticker: str, start: str, end: str) -> str:
        """ç»Ÿä¸€çš„å¸‚åœºæ•°æ®è·å–æ¥å£"""
        # è‡ªåŠ¨è¯†åˆ« A è‚¡/æ¸¯è‚¡/ç¾è‚¡
        # è°ƒç”¨å¯¹åº”çš„æ•°æ®æº

    def get_stock_fundamentals_unified(ticker: str) -> str:
        """ç»Ÿä¸€çš„åŸºæœ¬é¢æ•°æ®æ¥å£"""

    def get_stock_news_unified(ticker: str, days: int) -> str:
        """ç»Ÿä¸€çš„æ–°é—»æ•°æ®æ¥å£"""

    def get_stock_sentiment_unified(ticker: str) -> str:
        """ç»Ÿä¸€çš„æƒ…ç»ªæ•°æ®æ¥å£"""
```

#### 4.3.2 é™çº§æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è·å–é™çº§æœºåˆ¶                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  å°è¯•ä» MongoDB è·å–   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                   â”‚
            æˆåŠŸ                 å¤±è´¥
                â”‚                   â”‚
                â–¼                   â–¼
          è¿”å›æ•°æ®      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  é™çº§åˆ° Tushare/AkShare â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                   â”‚
                    æˆåŠŸ                 å¤±è´¥
                        â”‚                   â”‚
                        â–¼                   â–¼
                  è¿”å›æ•°æ®        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  è¿”å›é™çº§æ•°æ®     â”‚
                                  â”‚  æˆ–é”™è¯¯æç¤º       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

### 5.1 æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼

| æ¨¡å¼ | åº”ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|---------|------|
| **è§’è‰²æ¨¡å¼** | ä¸åŒåˆ†æå¸ˆæ‰®æ¼”ä¸åŒè§’è‰² | å¸‚åœºåˆ†æå¸ˆã€åŸºæœ¬é¢åˆ†æå¸ˆ |
| **è¾©è®ºæ¨¡å¼** | å¤šæ–¹è§‚ç‚¹è¾©è®º | çœ‹æ¶¨ç ”ç©¶å‘˜ vs çœ‹è·Œç ”ç©¶å‘˜ |
| **åä½œæ¨¡å¼** | å¤šæ™ºèƒ½ä½“ååŒå·¥ä½œ | åˆ†æå¸ˆ â†’ ç ”ç©¶å‘˜ â†’ äº¤æ˜“å‘˜ |
| **è®°å¿†æ¨¡å¼** | å†å²ç»éªŒç§¯ç´¯ | ChromaDB å‘é‡å­˜å‚¨ |
| **åæ€æ¨¡å¼** | å†³ç­–åæ€ä¼˜åŒ– | åæ€ä¸è®°å¿†æ¨¡å— |

### 5.2 æ™ºèƒ½ä½“äº¤äº’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ™ºèƒ½ä½“äº¤äº’æµç¨‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è¯·æ±‚ (è‚¡ç¥¨ä»£ç  + æ—¥æœŸ)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 1: å¹¶è¡Œåˆ†æ                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ å¸‚åœºåˆ†æå¸ˆ    â”‚  â”‚ åŸºæœ¬é¢åˆ†æå¸ˆ  â”‚  â”‚ æ–°é—»åˆ†æå¸ˆ    â”‚       â”‚
â”‚  â”‚ (æŠ€æœ¯é¢)      â”‚  â”‚ (è´¢åŠ¡é¢)      â”‚  â”‚ (èˆ†æƒ…é¢)      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                  â”‚                  â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                            â–¼                                   â”‚
â”‚                    å„è‡ªç”Ÿæˆåˆ†ææŠ¥å‘Š                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 2: æŠ•èµ„è¾©è®º                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  çœ‹æ¶¨ç ”ç©¶å‘˜       â”‚  â†â†’   â”‚  çœ‹è·Œç ”ç©¶å‘˜       â”‚           â”‚
â”‚  â”‚  (å¯»æ‰¾åšå¤šæœºä¼š)   â”‚  å¤šè½®  â”‚  (å¯»æ‰¾åšç©ºæœºä¼š)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                            â”‚                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                        â–¼                                        â”‚
â”‚              ç ”ç©¶ç»ç† (ç»¼åˆè£å†³)                                 â”‚
â”‚              ç”Ÿæˆ investment_plan                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 3: äº¤æ˜“å†³ç­–                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                äº¤æ˜“å‘˜                        â”‚           â”‚
â”‚  â”‚  åŸºäº investment_plan ç”Ÿæˆåˆæ­¥äº¤æ˜“å†³ç­–         â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 4: é£é™©è¯„ä¼°                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ æ¿€è¿›é£é™©è¯„ä¼°  â”‚  â”‚ ä¿å®ˆé£é™©è¯„ä¼°  â”‚  â”‚ ä¸­æ€§é£é™©è¯„ä¼°  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                  â”‚                  â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                            â–¼                                   â”‚
â”‚                      é£é™©ç»ç† (ç»¼åˆè£å†³)                        â”‚
â”‚                      ç”Ÿæˆ risk_assessment                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 5: æœ€ç»ˆå†³ç­–                                  â”‚
â”‚  ç»¼åˆ investment_plan + risk_assessment                      â”‚
â”‚  ç”Ÿæˆ final_trade_decision                                   â”‚
â”‚                                                               â”‚
â”‚  å†³ç­–é€‰é¡¹: ä¹°å…¥ / å–å‡º / æŒæœ‰ / ç­‰å¾…                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 è®°å¿†ä¸åæ€æœºåˆ¶

```python
# è®°å¿†ç³»ç»Ÿ
class FinancialSituationMemory:
    """é‡‘èæƒ…å¢ƒè®°å¿†ç³»ç»Ÿ"""

    def __init__(self, collection_name: str, config: dict):
        # ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“
        self.collection = chromadb_client.get_or_create_collection(
            name=collection_name
        )

    def get_memories(self, situation: str, n_matches: int = 3) -> List[dict]:
        """æ ¹æ®å½“å‰æƒ…å¢ƒæ£€ç´¢ç›¸å…³å†å²è®°å¿†"""
        # å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢
        results = self.collection.query(
            query_texts=[situation],
            n_results=n_matches
        )
        return results

    def add_memory(self, situation: str, decision: str, result: float):
        """æ·»åŠ æ–°çš„å†³ç­–è®°å¿†"""
        self.collection.add(
            documents=[situation],
            metadatas=[{
                "decision": decision,
                "result": result,
                "timestamp": datetime.now().isoformat()
            }]
        )

# åæ€æœºåˆ¶
def reflect_and_remember(self, returns_losses: float):
    """åæ€å†³ç­–å¹¶æ›´æ–°è®°å¿†"""
    # æ ¹æ®æ”¶ç›Š/æŸå¤±åæ€å„æ™ºèƒ½ä½“çš„å†³ç­–
    self.reflector.reflect_bull_researcher(...)
    self.reflector.reflect_bear_researcher(...)
    self.reflector.reflect_trader(...)
    self.reflector.reflect_invest_judge(...)
    self.reflector.reflect_risk_manager(...)
```

---

## 6. æ•°æ®æµä¸å¤„ç†

### 6.1 æ•°æ®æºæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æºæ¶æ„                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  è‚¡ç¥¨ä»£ç     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¸‚åœºç±»å‹è¯†åˆ«        â”‚
                    â”‚  StockUtils        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  A è‚¡æ•°æ®æº     â”‚    â”‚  æ¸¯è‚¡æ•°æ®æº     â”‚    â”‚  ç¾è‚¡æ•°æ®æº     â”‚
â”‚  - Tushare     â”‚    â”‚  - AkShare     â”‚    â”‚  - yfinance    â”‚
â”‚  - AkShare     â”‚    â”‚  - ä¸œæ–¹è´¢å¯Œ     â”‚    â”‚  - Finnhub     â”‚
â”‚  - BaoStock    â”‚    â”‚                â”‚    â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  ç»Ÿä¸€æ•°æ®æ¥å£        â”‚
                     â”‚  get_*_unified()    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  MongoDB ç¼“å­˜        â”‚
                     â”‚  (å¯é€‰)             â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  æ™ºèƒ½ä½“å·¥å…·è°ƒç”¨      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è‚¡ç¥¨ç±»å‹è¯†åˆ«

```python
# StockUtils è‚¡ç¥¨ç±»å‹è¯†åˆ«
class StockUtils:
    """è‚¡ç¥¨å·¥å…·ç±»ï¼Œç”¨äºè¯†åˆ«è‚¡ç¥¨ç±»å‹"""

    MARKET_PATTERNS = {
        'A_SHARE': [
            (r'^60\d{4}$', 'ä¸Šæµ·ä¸»æ¿', 'CNY', 'Â¥'),
            (r'^68\d{4}$', 'ä¸Šæµ·ç§‘åˆ›æ¿', 'CNY', 'Â¥'),
            (r'^00\d{4}$', 'æ·±åœ³ä¸»æ¿', 'CNY', 'Â¥'),
            (r'^30\d{4}$', 'æ·±åœ³åˆ›ä¸šæ¿', 'CNY', 'Â¥'),
        ],
        'HK': [
            (r'^\d{4}\.HK$', 'æ¸¯è‚¡', 'HKD', 'HK$'),
            (r'^\d{5}\.HK$', 'æ¸¯è‚¡åˆ›ä¸šæ¿', 'HKD', 'HK$'),
        ],
        'US': [
            (r'^[A-Z]+$', 'ç¾è‚¡', 'USD', '$'),
        ]
    }

    @staticmethod
    def get_market_info(ticker: str) -> dict:
        """è·å–è‚¡ç¥¨å¸‚åœºä¿¡æ¯"""
        # A è‚¡æ£€æµ‹
        if re.match(r'^\d{6}$', ticker):
            return {
                'is_china': True,
                'is_hk': False,
                'is_us': False,
                'market_name': 'ä¸­å›½Aè‚¡',
                'currency_name': 'äººæ°‘å¸',
                'currency_symbol': 'Â¥'
            }
        # æ¸¯è‚¡æ£€æµ‹
        elif '.HK' in ticker.upper():
            return {
                'is_china': False,
                'is_hk': True,
                'is_us': False,
                'market_name': 'æ¸¯è‚¡',
                'currency_name': 'æ¸¯å¸',
                'currency_symbol': 'HK$'
            }
        # ç¾è‚¡æ£€æµ‹
        else:
            return {
                'is_china': False,
                'is_hk': False,
                'is_us': True,
                'market_name': 'ç¾è‚¡',
                'currency_name': 'ç¾å…ƒ',
                'currency_symbol': '$'
            }
```

### 6.3 å·¥å…·è°ƒç”¨æœºåˆ¶

```python
# å·¥å…·ç»‘å®šç¤ºä¾‹
def create_market_analyst(llm, toolkit):
    def market_analyst_node(state):
        # è¯†åˆ«è‚¡ç¥¨ç±»å‹
        market_info = StockUtils.get_market_info(ticker)

        # é€‰æ‹©åˆé€‚çš„å·¥å…·
        tools = [toolkit.get_stock_market_data_unified]

        # æ„å»ºæç¤ºè¯
        prompt = ChatPromptTemplate.from_messages([
            ("system", """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è‚¡ç¥¨æŠ€æœ¯åˆ†æå¸ˆ...

            åˆ†æå¯¹è±¡ï¼š
            - å…¬å¸åç§°ï¼š{company_name}
            - è‚¡ç¥¨ä»£ç ï¼š{ticker}
            - æ‰€å±å¸‚åœºï¼š{market_name}
            - è®¡ä»·è´§å¸ï¼š{currency_name}ï¼ˆ{currency_symbol}ï¼‰
            """),
            MessagesPlaceholder(variable_name="messages"),
        ])

        # ç»‘å®šå·¥å…·åˆ° LLM
        chain = prompt | llm.bind_tools(tools)
        result = chain.invoke({"messages": state["messages"]})

        # å¤„ç†å·¥å…·è°ƒç”¨
        if result.tool_calls:
            # æ‰§è¡Œå·¥å…·
            tool_messages = []
            for tool_call in result.tool_calls:
                tool_result = execute_tool(tool_call)
                tool_messages.append(tool_result)

            # åŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
            final_result = llm.invoke(
                state["messages"] + [result] + tool_messages + [analysis_prompt]
            )

        return {"messages": [result], "market_report": report}

    return market_analyst_node
```

---

## 7. LLM é›†æˆæ¶æ„

### 7.1 LLM é€‚é…å™¨è®¾è®¡

```python
# LLM é€‚é…å™¨åŸºç±»
class OpenAICompatibleBase(ChatOpenAI):
    """OpenAI å…¼å®¹é€‚é…å™¨åŸºç±»"""

    def __init__(
        self,
        provider_name: str,
        model: str,
        api_key_env_var: str,
        base_url: str,
        api_key: Optional[str] = None,
        temperature: float = 0.1,
        max_tokens: Optional[int] = None,
        **kwargs
    ):
        # ç»Ÿä¸€åˆå§‹åŒ–é€»è¾‘
        # 1. è·å– API Key (ä¼˜å…ˆä½¿ç”¨ä¼ å…¥å‚æ•°ï¼Œå¦åˆ™ä»ç¯å¢ƒå˜é‡)
        # 2. éªŒè¯ API Key æœ‰æ•ˆæ€§
        # 3. è®¾ç½® OpenAI å…¼å®¹å‚æ•°
        super().__init__(
            model=model,
            api_key=api_key,
            base_url=base_url,
            temperature=temperature,
            max_tokens=max_tokens,
            **kwargs
        )

        # Token ä½¿ç”¨è·Ÿè¸ª
        self._track_token_usage(result, kwargs, start_time)

# å…·ä½“é€‚é…å™¨å®ç°
class ChatDeepSeekOpenAI(OpenAICompatibleBase):
    """DeepSeek é€‚é…å™¨"""
    def __init__(self, model="deepseek-chat", **kwargs):
        super().__init__(
            provider_name="deepseek",
            model=model,
            api_key_env_var="DEEPSEEK_API_KEY",
            base_url="https://api.deepseek.com",
            **kwargs
        )

class ChatDashScopeOpenAI(OpenAICompatibleBase):
    """é˜¿é‡Œç™¾ç‚¼é€‚é…å™¨"""
    def __init__(self, model="qwen-turbo", **kwargs):
        super().__init__(
            provider_name="dashscope",
            model=model,
            api_key_env_var="DASHSCOPE_API_KEY",
            base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
            **kwargs
        )

# å·¥å‚å‡½æ•°
def create_llm_by_provider(
    provider: str,
    model: str,
    backend_url: str,
    temperature: float,
    max_tokens: int,
    timeout: int,
    api_key: str = None
):
    """ç»Ÿä¸€çš„ LLM åˆ›å»ºå‡½æ•°"""
    if provider == "google":
        return ChatGoogleOpenAI(
            model=model,
            google_api_key=api_key or os.getenv('GOOGLE_API_KEY'),
            base_url=backend_url,
            temperature=temperature,
            max_tokens=max_tokens,
            timeout=timeout
        )
    elif provider == "dashscope":
        return ChatDashScopeOpenAI(
            model=model,
            api_key=api_key,
            base_url=backend_url,
            temperature=temperature,
            max_tokens=max_tokens
        )
    elif provider == "deepseek":
        return ChatDeepSeek(
            model=model,
            api_key=api_key,
            base_url=backend_url,
            temperature=temperature,
            max_tokens=max_tokens,
            timeout=timeout
        )
    # ... å…¶ä»–æä¾›å•†
```

### 7.2 æ··åˆæ¨¡å¼æ”¯æŒ

```python
# æ··åˆæ¨¡å¼ï¼šå¿«é€Ÿæ¨¡å‹å’Œæ·±åº¦æ¨¡å‹æ¥è‡ªä¸åŒå‚å®¶
class TradingAgentsGraph:
    def __init__(self, config=None):
        # æ£€æµ‹æ··åˆæ¨¡å¼
        quick_provider = self.config.get("quick_provider")
        deep_provider = self.config.get("deep_provider")

        if quick_provider and deep_provider and quick_provider != deep_provider:
            logger.info("ğŸ”€ æ··åˆæ¨¡å¼ï¼šå¿«é€Ÿæ¨¡å‹å’Œæ·±åº¦æ¨¡å‹æ¥è‡ªä¸åŒå‚å®¶")

            # åˆ›å»ºå¿«é€Ÿæ¨¡å‹ (ç”¨äºå·¥å…·è°ƒç”¨ã€ç®€å•åˆ†æ)
            self.quick_thinking_llm = create_llm_by_provider(
                provider=quick_provider,
                model=self.config["quick_think_llm"],
                backend_url=self.config.get("quick_backend_url"),
                temperature=quick_temperature,
                max_tokens=quick_max_tokens,
                api_key=self.config.get("quick_api_key")
            )

            # åˆ›å»ºæ·±åº¦æ¨¡å‹ (ç”¨äºæ·±åº¦åˆ†æã€å†³ç­–)
            self.deep_thinking_llm = create_llm_by_provider(
                provider=deep_provider,
                model=self.config["deep_think_llm"],
                backend_url=self.config.get("deep_backend_url"),
                temperature=deep_temperature,
                max_tokens=deep_max_tokens,
                api_key=self.config.get("deep_api_key")
            )
```

### 7.3 Google å·¥å…·è°ƒç”¨å¤„ç†

```python
# Google æ¨¡å‹ç‰¹æ®Šçš„å·¥å…·è°ƒç”¨æ ¼å¼å¤„ç†
class GoogleToolCallHandler:
    """Google å·¥å…·è°ƒç”¨å¤„ç†å™¨"""

    @staticmethod
    def is_google_model(llm) -> bool:
        """æ£€æµ‹æ˜¯å¦ä¸º Google æ¨¡å‹"""
        return "google" in str(type(llm)).lower()

    @staticmethod
    def handle_google_tool_calls(
        result, llm, tools, state, analysis_prompt_template, analyst_name
    ):
        """å¤„ç† Google æ¨¡å‹çš„å·¥å…·è°ƒç”¨"""
        # Google æ¨¡å‹çš„å·¥å…·è°ƒç”¨æ ¼å¼éœ€è¦ç‰¹æ®Šå¤„ç†
        # 1. æå–å·¥å…·è°ƒç”¨
        # 2. æ‰§è¡Œå·¥å…·
        # 3. é‡æ–°æ ¼å¼åŒ–å·¥å…·ç»“æœ
        # 4. è°ƒç”¨ LLM ç”Ÿæˆæœ€ç»ˆåˆ†æ

        # åˆ›å»ºåˆ†ææç¤ºè¯
        analysis_prompt = GoogleToolCallHandler.create_analysis_prompt(
            ticker=ticker,
            company_name=company_name,
            analyst_type="å¸‚åœºåˆ†æ",
            specific_requirements="..."
        )

        # å¤„ç†å·¥å…·è°ƒç”¨
        messages = state["messages"] + [result]
        for tool_call in result.tool_calls:
            tool_result = execute_tool(tool_call)
            tool_message = ToolMessage(
                content=tool_result,
                tool_call_id=tool_call['id']
            )
            messages.append(tool_message)

        # ç”Ÿæˆæœ€ç»ˆåˆ†æ
        final_result = llm.invoke(messages + [HumanMessage(content=analysis_prompt)])
        report = final_result.content

        return report, messages
```

---

## 8. éƒ¨ç½²ä¸è¿ç»´

### 8.1 éƒ¨ç½²æ–¹å¼

| éƒ¨ç½²æ–¹å¼ | é€‚ç”¨åœºæ™¯ | éš¾åº¦ |
|---------|---------|------|
| **ç»¿è‰²ç‰ˆ** | Windows ç”¨æˆ·ã€å¿«é€Ÿä½“éªŒ | â­ ç®€å• |
| **Docker ç‰ˆ** | ç”Ÿäº§ç¯å¢ƒã€è·¨å¹³å° | â­â­ ä¸­ç­‰ |
| **æœ¬åœ°ä»£ç ç‰ˆ** | å¼€å‘è€…ã€å®šåˆ¶éœ€æ±‚ | â­â­â­ è¾ƒéš¾ |

### 8.2 Docker éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  tradingagents-cn:
    image: hsliuping/tradingagents-cn:latest
    container_name: tradingagents-cn
    ports:
      - "8000:8000"
    environment:
      - MONGODB_URI=mongodb://mongodb:27017/
      - REDIS_URI=redis://redis:6379/0
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    depends_on:
      - mongodb
      - redis
    restart: unless-stopped

  mongodb:
    image: mongo:7
    container_name: tradingagents-mongodb
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: tradingagents-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  mongodb_data:
  redis_data:
```

### 8.3 é…ç½®ç®¡ç†

```python
# é…ç½®ç®¡ç†å™¨
class ConfigManager:
    """é…ç½®ç®¡ç†å™¨"""

    def __init__(self):
        self.mongodb_config = self._load_mongodb_config()
        self.llm_providers = self._load_llm_providers()
        self.data_sources = self._load_data_sources()

    def _load_mongodb_config(self) -> dict:
        """ä»æ•°æ®åº“è¯»å– MongoDB é…ç½®"""
        # æ”¯æŒåŠ¨æ€é…ç½®
        return {
            "host": "localhost",
            "port": 27017,
            "database": "tradingagents"
        }

    def _load_llm_providers(self) -> dict:
        """ä»æ•°æ®åº“è¯»å– LLM æä¾›å•†é…ç½®"""
        # æ”¯æŒå¤šä¸ª LLM æä¾›å•†
        return {
            "providers": [
                {
                    "name": "google",
                    "api_key": "...",
                    "models": ["gemini-2.0-flash", "gemini-1.5-pro"]
                },
                {
                    "name": "dashscope",
                    "api_key": "...",
                    "models": ["qwen-plus", "qwen-max"]
                }
            ]
        }

    def get_provider_config(self, provider_name: str) -> dict:
        """è·å–æŒ‡å®šæä¾›å•†çš„é…ç½®"""
        for provider in self.llm_providers["providers"]:
            if provider["name"] == provider_name:
                return provider
        return None
```

### 8.4 æ—¥å¿—ç³»ç»Ÿ

```python
# ç»Ÿä¸€æ—¥å¿—ç®¡ç†
class LogManager:
    """ç»Ÿä¸€æ—¥å¿—ç®¡ç†å™¨"""

    def __init__(self):
        self.setup_logging()

    def setup_logging(self):
        """é…ç½®æ—¥å¿—ç³»ç»Ÿ"""
        import logging
        from logging.handlers import RotatingFileHandler

        # åˆ›å»ºæ—¥å¿—ç›®å½•
        log_dir = Path("logs")
        log_dir.mkdir(exist_ok=True)

        # é…ç½®æ ¹æ—¥å¿—è®°å½•å™¨
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            handlers=[
                RotatingFileHandler(
                    log_dir / "tradingagents.log",
                    maxBytes=10*1024*1024,  # 10MB
                    backupCount=5
                ),
                logging.StreamHandler()
            ]
        )

# ä½¿ç”¨ç¤ºä¾‹
from tradingagents.utils.logging_manager import get_logger
logger = get_logger('agents')
logger.info("æ™ºèƒ½ä½“å¯åŠ¨")
logger.error("é”™è¯¯ä¿¡æ¯", exc_info=True)
```

### 8.5 æ€§èƒ½ç›‘æ§

```python
# æ€§èƒ½æ•°æ®æ”¶é›†
def _build_performance_data(self, node_timings, total_elapsed):
    """æ„å»ºæ€§èƒ½æ•°æ®ç»“æ„"""
    return {
        "total_time": round(total_elapsed, 2),
        "total_time_minutes": round(total_elapsed / 60, 2),
        "node_count": len(node_timings),
        "average_node_time": round(sum(node_timings.values()) / len(node_timings), 2),
        "slowest_node": {
            "name": max(node_timings.items(), key=lambda x: x[1])[0],
            "time": round(max(node_timings.values()), 2)
        },
        "category_timings": {
            "analyst_team": {...},
            "tool_calls": {...},
            "research_team": {...},
            "trader_team": {...},
            "risk_management_team": {...}
        },
        "llm_config": {
            "provider": self.config.get('llm_provider'),
            "deep_think_model": self.config.get('deep_think_llm'),
            "quick_think_model": self.config.get('quick_think_llm')
        }
    }
```

---

## 9. æ€»ç»“ä¸å»ºè®®

### 9.1 é¡¹ç›®ä¼˜åŠ¿

1. **å¤šæ™ºèƒ½ä½“æ¶æ„** - LangGraph çŠ¶æ€å›¾ç¼–æ’ï¼Œæ™ºèƒ½ä½“åä½œæ¸…æ™°
2. **LLM çµæ´»é›†æˆ** - æ”¯æŒ 8+ ä¸»æµ LLM æä¾›å•†
3. **å¤šå¸‚åœºæ”¯æŒ** - A è‚¡/æ¸¯è‚¡/ç¾è‚¡ å…¨è¦†ç›–
4. **æ•°æ®æºä¸°å¯Œ** - Tushareã€AkShareã€yfinance ç­‰
5. **è®°å¿†ä¸åæ€** - ChromaDB å‘é‡å­˜å‚¨ï¼ŒæŒç»­ä¼˜åŒ–
6. **å®Œæ•´å‰åç«¯** - FastAPI + Vue 3ï¼Œä¼ä¸šçº§æ¶æ„
7. **ä¸­æ–‡åŒ–å‹å¥½** - æç¤ºè¯ã€ç•Œé¢ã€æ–‡æ¡£å…¨ä¸­æ–‡

### 9.2 æ¶æ„äº®ç‚¹

| äº®ç‚¹ | æè¿° |
|------|------|
| **ç»Ÿä¸€æ•°æ®æ¥å£** | è‡ªåŠ¨è¯†åˆ«è‚¡ç¥¨ç±»å‹ï¼Œè°ƒç”¨ç›¸åº”æ•°æ®æº |
| **é™çº§æœºåˆ¶** | MongoDB â†’ Tushare â†’ ç¼“å­˜ â†’ é”™è¯¯å¤„ç† |
| **æ··åˆæ¨¡å¼** | å¿«é€Ÿæ¨¡å‹ + æ·±åº¦æ¨¡å‹ï¼Œä¼˜åŒ–æˆæœ¬ä¸æ•ˆæœ |
| **å·¥å…·è°ƒç”¨å¤„ç†** | Google ç­‰ç‰¹æ®Šæ ¼å¼çš„ç»Ÿä¸€å¤„ç† |
| **è¿›åº¦è·Ÿè¸ª** | SSE å®æ—¶æ¨é€åˆ†æè¿›åº¦ |
| **æ€§èƒ½ç›‘æ§** | èŠ‚ç‚¹çº§åˆ«çš„æ‰§è¡Œæ—¶é—´ç»Ÿè®¡ |
| **Token è·Ÿè¸ª** | LLM ä½¿ç”¨é‡è®°å½•ä¸æˆæœ¬æ§åˆ¶ |

### 9.3 æ”¹è¿›å»ºè®®

#### çŸ­æœŸæ”¹è¿›
1. **å•å…ƒæµ‹è¯•è¦†ç›–** - å½“å‰æµ‹è¯•è¾ƒå°‘ï¼Œéœ€å¢åŠ æ ¸å¿ƒæ¨¡å—æµ‹è¯•
2. **API æ–‡æ¡£** - å®Œå–„ FastAPI çš„ Swagger æ–‡æ¡£
3. **é”™è¯¯å¤„ç†** - å¢å¼ºå¼‚å¸¸å¤„ç†å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
4. **æ—¥å¿—ä¼˜åŒ–** - ç»“æ„åŒ–æ—¥å¿—ï¼Œä¾¿äºæŸ¥è¯¢åˆ†æ

#### ä¸­æœŸæ”¹è¿›
1. **ç¼“å­˜ä¼˜åŒ–** - Redis ç¼“å­˜ç­–ç•¥ï¼Œå‡å°‘é‡å¤è®¡ç®—
2. **ä»»åŠ¡é˜Ÿåˆ—** - Celery ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒæ‰¹é‡åˆ†æ
3. **æƒé™ç®¡ç†** - ç»†ç²’åº¦çš„ç”¨æˆ·æƒé™æ§åˆ¶
4. **ç›‘æ§å‘Šè­¦** - Prometheus + Grafana ç›‘æ§

#### é•¿æœŸæ”¹è¿›
1. **å¾®æœåŠ¡æ‹†åˆ†** - åˆ†ææœåŠ¡ã€æ•°æ®æœåŠ¡ã€ä»»åŠ¡æœåŠ¡ç‹¬ç«‹éƒ¨ç½²
2. **åˆ†å¸ƒå¼éƒ¨ç½²** - æ”¯æŒå¤šèŠ‚ç‚¹å¹¶è¡Œåˆ†æ
3. **æ¨¡å‹å¾®è°ƒ** - é’ˆå¯¹é‡‘èåœºæ™¯å¾®è°ƒ LLM
4. **ç­–ç•¥å›æµ‹** - å®Œæ•´çš„ç­–ç•¥å›æµ‹æ¡†æ¶

### 9.4 æ½œåœ¨é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| LLM ç¨³å®šæ€§ | åˆ†æå¤±è´¥ | å¤šæä¾›å•†å¤‡ä»½ã€é‡è¯•æœºåˆ¶ |
| æ•°æ®æºé™åˆ¶ | æ•°æ®ç¼ºå¤± | å¤šæ•°æ®æºã€é™çº§æœºåˆ¶ |
| æˆæœ¬æ§åˆ¶ | Token è´¹ç”¨ | Token è·Ÿè¸ªã€ç¼“å­˜ä¼˜åŒ– |
| ä¾èµ–ç‰ˆæœ¬ | å…¼å®¹æ€§é—®é¢˜ | ç‰ˆæœ¬é”å®šã€å®šæœŸæ›´æ–° |

---

## é™„å½•

### A. å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½æè¿° |
|---------|---------|
| `tradingagents/graph/trading_graph.py` | ä¸»å›¾ç¼–æ’ï¼ŒLLM åˆ›å»º |
| `tradingagents/graph/propagation.py` | çŠ¶æ€åˆå§‹åŒ–ä¸ä¼ æ’­ |
| `tradingagents/agents/analysts/market_analyst.py` | å¸‚åœºåˆ†æå¸ˆ |
| `tradingagents/agents/trader/trader.py` | äº¤æ˜“å‘˜å†³ç­– |
| `tradingagents/llm_adapters/openai_compatible_base.py` | LLM é€‚é…å™¨åŸºç±» |
| `tradingagents/dataflows/stock_data_service.py` | ç»Ÿä¸€æ•°æ®æœåŠ¡ |
| `app/main.py` | FastAPI åº”ç”¨å…¥å£ |
| `frontend/src/` | Vue 3 å‰ç«¯æºç  |

### B. API ç«¯ç‚¹æ‘˜è¦

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/analysis/stock` | POST | åˆ›å»ºè‚¡ç¥¨åˆ†æä»»åŠ¡ |
| `/api/analysis/{task_id}` | GET | è·å–åˆ†æç»“æœ |
| `/api/analysis/{task_id}/stream` | GET | SSE å®æ—¶è¿›åº¦ |
| `/api/stocks/search` | GET | è‚¡ç¥¨æœç´¢ |
| `/api/stocks/list` | GET | è‚¡ç¥¨åˆ—è¡¨ |
| `/api/models/providers` | GET | LLM æä¾›å•†åˆ—è¡¨ |
| `/api/models/configure` | POST | é…ç½® LLM |
| `/api/reports/export` | POST | å¯¼å‡ºæŠ¥å‘Š |

### C. ç¯å¢ƒå˜é‡é…ç½®

```bash
# LLM API Keys
GOOGLE_API_KEY=your_google_api_key
DASHSCOPE_API_KEY=your_dashscope_api_key
DEEPSEEK_API_KEY=your_deepseek_api_key
ZHIPU_API_KEY=your_zhipu_api_key

# æ•°æ®æºé…ç½®
TUSHARE_TOKEN=your_tushare_token
AKSHARE_ENABLED=true

# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://localhost:27017/
REDIS_URI=redis://localhost:6379/0

# ç³»ç»Ÿé…ç½®
LOG_LEVEL=INFO
MAX_WORKERS=4
ENABLE_CACHE=true
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-28
**åˆ†æå·¥å…·**: Claude Code
**é¡¹ç›®è·¯å¾„**: `/home/zcxggmu/workspace/hello-projs/posp/trading/TradingAgents-CN`
**æŠ¥å‘Šç‰ˆæœ¬**: 1.0
