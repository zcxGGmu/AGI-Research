# NoFX é¡¹ç›®æŠ€æœ¯åˆ†ææŠ¥å‘Š

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆåˆ†æ](#2-æŠ€æœ¯æ ˆåˆ†æ)
3. [æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
4. [æ ¸å¿ƒæ¨¡å—åˆ†æ](#4-æ ¸å¿ƒæ¨¡å—åˆ†æ)
5. [æ•°æ®æµä¸ä¸šåŠ¡æµç¨‹](#5-æ•°æ®æµä¸ä¸šåŠ¡æµç¨‹)
6. [è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ](#6-è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ)
7. [å®‰å…¨æœºåˆ¶](#7-å®‰å…¨æœºåˆ¶)
8. [æ€§èƒ½ä¸å¯æ‰©å±•æ€§](#8-æ€§èƒ½ä¸å¯æ‰©å±•æ€§)
9. [éƒ¨ç½²ä¸è¿ç»´](#9-éƒ¨ç½²ä¸è¿ç»´)
10. [æ€»ç»“ä¸å»ºè®®](#10-æ€»ç»“ä¸å»ºè®®)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

**NoFX** æ˜¯ä¸€ä¸ªåŸºäº AI é©±åŠ¨çš„åŠ å¯†è´§å¸è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿï¼Œé‡‡ç”¨ Go è¯­è¨€åç«¯ä¸ TypeScript/React å‰ç«¯çš„å…¨æ ˆæ¶æ„ã€‚é¡¹ç›®æ”¯æŒå¤šäº¤æ˜“æ‰€æ¥å…¥ã€ç­–ç•¥å›æµ‹ã€å®æ—¶äº¤æ˜“ã€AI è¾©è®ºå†³ç­–ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### 1.2 é¡¹ç›®ç»“æ„

```
nofx/
â”œâ”€â”€ api/              # REST API æœåŠ¡å±‚
â”œâ”€â”€ backtest/         # å›æµ‹å¼•æ“
â”œâ”€â”€ decision/         # å†³ç­–å¼•æ“ä¸ç­–ç•¥ç³»ç»Ÿ
â”œâ”€â”€ debate/           # AI å¤šæ™ºèƒ½ä½“è¾©è®ºç³»ç»Ÿ
â”œâ”€â”€ trader/           # äº¤æ˜“æ‰§è¡Œå™¨
â”œâ”€â”€ manager/          # äº¤æ˜“ç®¡ç†å™¨
â”œâ”€â”€ provider/         # äº¤æ˜“æ‰€æä¾›å•†æ¥å£
â”œâ”€â”€ store/            # æ•°æ®æŒä¹…åŒ–å±‚
â”œâ”€â”€ market/           # å¸‚åœºæ•°æ®è·å–
â”œâ”€â”€ mcp/              # AI æ¨¡å‹å®¢æˆ·ç«¯æ¥å£
â”œâ”€â”€ config/           # å…¨å±€é…ç½®
â”œâ”€â”€ logger/           # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ experience/       # ä½“éªŒæ”¹è¿›æ•°æ®æ”¶é›†
â”œâ”€â”€ web/              # å‰ç«¯ (React + TypeScript)
â”œâ”€â”€ main.go           # ç¨‹åºå…¥å£
â”œâ”€â”€ go.mod            # Go æ¨¡å—ä¾èµ–
â””â”€â”€ Makefile          # æ„å»ºé…ç½®
```

---

## 2. æŠ€æœ¯æ ˆåˆ†æ

### 2.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬/è¯´æ˜ | ç”¨é€” |
|------|----------|------|
| **Go** | 1.21+ | åç«¯æ ¸å¿ƒè¯­è¨€ |
| **Gin** | github.com/gin-gonic/gin | HTTP Web æ¡†æ¶ |
| **SQLite** | modernc.org/sqlite | åµŒå…¥å¼æ•°æ®åº“ |
| **JWT** | github.com/golang-jwt/jwt | ç”¨æˆ·è®¤è¯ |
| **bcrypt** | golang.org/x/crypto/bcrypt | å¯†ç åŠ å¯† |
| **WebSocket** | gorilla/websocket | å®æ—¶é€šä¿¡ |
| **SSE** | è‡ªå®ç° | æœåŠ¡å™¨æ¨é€äº‹ä»¶ |

### 2.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 18.x | UI æ¡†æ¶ |
| **TypeScript** | 5.x | ç±»å‹å®‰å…¨ |
| **Vite** | 5.x | æ„å»ºå·¥å…· |
| **Tailwind CSS** | 3.x | æ ·å¼æ¡†æ¶ |
| **Recharts** | 2.x | æ•°æ®å¯è§†åŒ– |
| **shadcn/ui** | latest | UI ç»„ä»¶åº“ |

### 2.3 AI æ¨¡å‹é›†æˆ

é¡¹ç›®é€šè¿‡ç»Ÿä¸€çš„ `mcp` (Model Control Protocol) æ¥å£æ”¯æŒå¤šç§ AI æä¾›å•†ï¼š

- DeepSeek
- Qwen (é€šä¹‰åƒé—®)
- OpenAI (GPT ç³»åˆ—)
- Claude (Anthropic)
- Gemini (Google)
- Grok (xAI)
- Kimi (æœˆä¹‹æš—é¢)

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å‰ç«¯ (React + TS)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»ªè¡¨ç›˜   â”‚ â”‚ ç­–ç•¥é…ç½® â”‚ â”‚ å›æµ‹ç•Œé¢ â”‚ â”‚ AIè¾©è®º   â”‚ â”‚ äº¤æ˜“ç›‘æ§ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚            â”‚            â”‚
         â–¼            â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        REST API + WebSocket                         â”‚
â”‚                     (api/server.go + handlers)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Manager    â”‚    â”‚   Backtest   â”‚    â”‚    Debate    â”‚
â”‚  äº¤æ˜“ç®¡ç†å™¨   â”‚    â”‚   å›æµ‹å¼•æ“    â”‚    â”‚  AIè¾©è®ºå¼•æ“   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Trader     â”‚    â”‚   Decision   â”‚    â”‚     MCP      â”‚
â”‚  äº¤æ˜“æ‰§è¡Œå™¨   â”‚    â”‚  å†³ç­–å¼•æ“     â”‚    â”‚  AIæ¨¡å‹å®¢æˆ·ç«¯ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Provider    â”‚  â”‚     Market     â”‚
        â”‚  äº¤æ˜“æ‰€æ¥å£     â”‚  â”‚   å¸‚åœºæ•°æ®      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                   â”‚
                 â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            Binance API          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          Store (SQLite)         â”‚
        â”‚  - ç”¨æˆ· - ç­–ç•¥ - äº¤æ˜“è®°å½•         â”‚
        â”‚  - å›æµ‹æ•°æ® - AIè¾©è®º             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åˆ†å±‚æ¶æ„

| å±‚çº§ | æ¨¡å— | èŒè´£ |
|------|------|------|
| **è¡¨ç°å±‚** | web/ | ç”¨æˆ·ç•Œé¢ã€äº¤äº’é€»è¾‘ |
| **API å±‚** | api/ | è·¯ç”±ã€è®¤è¯ã€è¯·æ±‚å¤„ç† |
| **ä¸šåŠ¡å±‚** | manager/, trader/, backtest/, debate/ | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| **ç­–ç•¥å±‚** | decision/ | å†³ç­–å¼•æ“ã€ç­–ç•¥æ‰§è¡Œ |
| **æ•°æ®å±‚** | store/ | æ•°æ®æŒä¹…åŒ–ã€æŸ¥è¯¢ |
| **åŸºç¡€è®¾æ–½** | market/, provider/, mcp/ | å¤–éƒ¨æœåŠ¡é›†æˆ |

### 3.3 æ¨¡å—ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         main.go                           â”‚
â”‚                      ç¨‹åºå…¥å£ / ä¾èµ–æ³¨å…¥                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼            â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  api/   â”‚ â”‚manager/ â”‚ â”‚backtest/â”‚ â”‚ debate/ â”‚ â”‚ trader/ â”‚
â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚           â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚           â”‚           â”‚
                 â–¼           â–¼           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚decision/â”‚ â”‚  store/ â”‚ â”‚  mcp/   â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                 â”‚           â”‚           â”‚
                 â–¼           â–¼           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ market/ â”‚ â”‚provider/â”‚ â”‚logger/  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ ¸å¿ƒæ¨¡å—åˆ†æ

### 4.1 API æ¨¡å— (api/)

**æ ¸å¿ƒæ–‡ä»¶**: `api/server.go`

#### åŠŸèƒ½èŒè´£
- æä¾› REST API æœåŠ¡
- JWT è®¤è¯ä¸­é—´ä»¶
- WebSocket/SSE å®æ—¶æ¨é€
- è·¯ç”±æ³¨å†Œä¸è¯·æ±‚åˆ†å‘

#### å…³é”®ä»£ç ç»“æ„

```go
type Server struct {
    router      *gin.Engine
    store       *store.Store
    jwtSecret   string
    // ... å…¶ä»–ä¾èµ–
}

// ä¸»è¦è·¯ç”±ç»„
func (s *Server) setupRoutes() {
    // è®¤è¯è·¯ç”±
    auth := s.router.Group("/api/auth")
    // ç”¨æˆ·è·¯ç”±
    users := s.router.Group("/api/users").Use(authMiddleware())
    // äº¤æ˜“å‘˜è·¯ç”±
    traders := s.router.Group("/api/traders").Use(authMiddleware())
    // å›æµ‹è·¯ç”±
    backtests := s.router.Group("/api/backtests").Use(authMiddleware())
    // ç­–ç•¥è·¯ç”±
    strategies := s.router.Group("/api/strategies").Use(authMiddleware())
    // AI è¾©è®ºè·¯ç”±
    debates := s.router.Group("/api/debates").Use(authMiddleware())
}
```

#### è®¾è®¡ç‰¹ç‚¹
1. **ä¸­é—´ä»¶æ¨¡å¼**: è®¤è¯ã€CORSã€æ—¥å¿—è®°å½•é€šè¿‡ä¸­é—´ä»¶å®ç°
2. **ä¾èµ–æ³¨å…¥**: Server ç»“æ„ä½“é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥æ‰€æœ‰ä¾èµ–
3. **SSE æµå¼å“åº”**: æ”¯æŒ AI è¾©è®ºè¿‡ç¨‹å®æ—¶æ¨é€

---

### 4.2 å†³ç­–å¼•æ“æ¨¡å— (decision/)

**æ ¸å¿ƒæ–‡ä»¶**: `decision/engine.go`

#### åŠŸèƒ½èŒè´£
- ç­–ç•¥é…ç½®è§£æä¸ç®¡ç†
- å€™é€‰å¸ç§ç­›é€‰
- å¸‚åœºæ•°æ®ä¸Šä¸‹æ–‡æ„å»º
- AI å†³ç­–æç¤ºè¯ç”Ÿæˆ
- å†³ç­–è§£æä¸éªŒè¯

#### æ ¸å¿ƒç»“æ„

```go
// StrategyEngine ç­–ç•¥å¼•æ“
type StrategyEngine struct {
    config *store.StrategyConfig
}

// Context å†³ç­–ä¸Šä¸‹æ–‡
type Context struct {
    CurrentTime     string
    RuntimeMinutes  int
    CallCount       int
    Account         AccountInfo
    Positions       []PositionInfo
    CandidateCoins  []CandidateCoin
    MarketDataMap   map[string]*market.Data
    QuantDataMap    map[string]*QuantData
    OIRankingData   *OIRankingData
}

// Decision å†³ç­–ç»“æœ
type Decision struct {
    Symbol          string
    Action          string  // open_long, open_short, close_long, close_short, hold, wait
    Leverage        int
    PositionSizeUSD float64
    StopLoss        float64
    TakeProfit      float64
    Confidence      int
    Reasoning       string
}
```

#### å†³ç­–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–ç•¥é…ç½®åŠ è½½    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å€™é€‰å¸ç§ç­›é€‰     â”‚ â† æ”¯æŒå¤šç§ç­›é€‰ç­–ç•¥:
â”‚                  â”‚   - å›ºå®šåˆ—è¡¨ã€å¸‚å€¼æ’åã€æ¶¨è·Œå¹…è¿‡æ»¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¸‚åœºæ•°æ®è·å–     â”‚ â† Kçº¿ã€æŒ‡æ ‡ã€é‡åŒ–æ•°æ®ã€æŒä»“æ’å
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿæç¤ºè¯ç”Ÿæˆ   â”‚ â† æ ¹æ®ç­–ç•¥é…ç½®åŠ¨æ€ç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI æ¨¡å‹è°ƒç”¨      â”‚ â† é€šè¿‡ MCP ç»Ÿä¸€æ¥å£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†³ç­–è§£æä¸éªŒè¯   â”‚ â† JSON è§£æã€åŠ¨ä½œå½’ä¸€åŒ–ã€é»˜è®¤å€¼å¡«å……
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›å†³ç­–ç»“æœ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.3 AI è¾©è®ºå¼•æ“æ¨¡å— (debate/)

**æ ¸å¿ƒæ–‡ä»¶**: `debate/engine.go`

#### åŠŸèƒ½èŒè´£
- å¤š AI æ™ºèƒ½ä½“è¾©è®ºç»„ç»‡
- ä¸ªæ€§åŒ–è§’è‰²åˆ†é…
- å¤šè½®è¾©è®ºåè°ƒ
- æŠ•ç¥¨å…±è¯†æœºåˆ¶
- å®æ—¶äº‹ä»¶æ¨é€

#### æ ¸å¿ƒç»“æ„

```go
// DebateEngine è¾©è®ºå¼•æ“
type DebateEngine struct {
    debateStore   *store.DebateStore
    strategyStore *store.StrategyStore
    aiModelStore  *store.AIModelStore
    clients       map[string]mcp.AIClient
    clientsMu     sync.RWMutex

    // SSE äº‹ä»¶å›è°ƒ
    OnRoundStart func(sessionID string, round int)
    OnMessage    func(sessionID string, msg *store.DebateMessage)
    OnRoundEnd   func(sessionID string, round int)
    OnVote       func(sessionID string, vote *store.DebateVote)
    OnConsensus  func(sessionID string, decision *store.DebateDecision)
    OnError      func(sessionID string, err error)
}
```

#### è¾©è®ºè§’è‰²ç±»å‹

| è§’è‰² | ä¸ªæ€§æè¿° | Emoji |
|------|---------|-------|
| **Bull** | æ¿€è¿›å¤šå¤´ - å¯»æ‰¾åšå¤šæœºä¼šï¼Œç›¸ä¿¡åŠ¨èƒ½å»¶ç»­ | ğŸ‚ |
| **Bear** | è°¨æ…ç©ºå¤´ - å…³æ³¨é£é™©ï¼Œå¯»æ‰¾åšç©ºæœºä¼š | ğŸ» |
| **Analyst** | æ•°æ®åˆ†æå¸ˆ - ä¸­ç«‹å®¢è§‚ï¼Œæ•°æ®é©±åŠ¨ | ğŸ“Š |
| **Contrarian** | åå‘æŠ•èµ„è€… - æŒ‘æˆ˜ä¸»æµè§‚ç‚¹ | ğŸ”„ |
| **Risk Manager** | é£é™©ç®¡ç†è€… - å…³æ³¨ä»“ä½ä¸æ­¢æŸ | ğŸ›¡ï¸ |

#### è¾©è®ºæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ›å»ºè¾©è®ºä¼šè¯     â”‚
â”‚ - é€‰æ‹©å‚ä¸è€…     â”‚
â”‚ - åˆ†é…è§’è‰²       â”‚
â”‚ - è®¾ç½®è½®æ¬¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ„å»ºå¸‚åœºä¸Šä¸‹æ–‡   â”‚ â† ä½¿ç”¨ç­–ç•¥å¼•æ“ç»Ÿä¸€ç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å¤šè½®è¾©è®ºå¾ªç¯                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Round 1: åˆå§‹è§‚ç‚¹é™ˆè¿°          â”‚  â”‚
â”‚  â”‚ - æ¯ä¸ªå‚ä¸è€…ç‹¬ç«‹åˆ†æ           â”‚  â”‚
â”‚  â”‚ - è¾“å‡ºå†³ç­–ä¸æ¨ç†               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Round 2+: è¾©è®ºåé©³             â”‚  â”‚
â”‚  â”‚ - æŸ¥çœ‹å†å²æ¶ˆæ¯                â”‚  â”‚
â”‚  â”‚ - å›åº”å…¶ä»–å‚ä¸è€…              â”‚  â”‚
â”‚  â”‚ - ä¿®æ­£æˆ–åšæŒè§‚ç‚¹              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ æŠ•ç¥¨é˜¶æ®µ          â”‚
          â”‚ - æœ€ç»ˆè§‚ç‚¹ç¡®è®¤     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ å…±è¯†è®¡ç®—          â”‚ â† åŠ æƒæŠ•ç¥¨
          â”‚ - æŒ‰å¸ç§èšåˆ      â”‚   ç½®ä¿¡åº¦æƒé‡
          â”‚ - åŠ¨ä½œä¼˜å…ˆçº§      â”‚   å¹³å‡å‚æ•°è®¡ç®—
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ è¾“å‡ºæœ€ç»ˆå†³ç­–      â”‚
          â”‚ - å¤šå¸ç§å†³ç­–åˆ—è¡¨  â”‚
          â”‚ - æ‰§è¡Œæˆ–ä»…åˆ†æ    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.4 å›æµ‹å¼•æ“æ¨¡å— (backtest/)

**æ ¸å¿ƒæ–‡ä»¶**: `backtest/runner.go`

#### åŠŸèƒ½èŒè´£
- å†å²æ•°æ®å›æ”¾
- æ¨¡æ‹Ÿè´¦æˆ·ç®¡ç†
- è®¢å•æ¨¡æ‹Ÿæ‰§è¡Œ
- æ€§èƒ½æŒ‡æ ‡è®¡ç®—
- æ£€æŸ¥ç‚¹ä¸æ¢å¤

#### æ ¸å¿ƒç»“æ„

```go
// Runner å›æµ‹è¿è¡Œå™¨
type Runner struct {
    cfg            BacktestConfig
    feed           *DataFeed
    account        *BacktestAccount
    strategyEngine *decision.StrategyEngine
    mcpClient      mcp.AIClient

    // çŠ¶æ€ç®¡ç†
    status   RunState
    state    *BacktestState

    // æ§åˆ¶é€šé“
    pauseCh  chan struct{}
    resumeCh chan struct{}
    stopCh   chan struct{}
    doneCh   chan struct{}

    // AI ç¼“å­˜
    aiCache   *AICache
    cachePath string
}

// BacktestAccount å›æµ‹è´¦æˆ·
type BacktestAccount struct {
    initialBalance float64
    cash           float64
    positions      map[string]*position
    realizedPnL    float64
}
```

#### å›æµ‹æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹åŒ–å›æµ‹é…ç½®   â”‚
â”‚ - æ—¶é—´èŒƒå›´       â”‚
â”‚ - åˆå§‹èµ„é‡‘       â”‚
â”‚ - äº¤æ˜“å¯¹         â”‚
â”‚ - ç­–ç•¥é…ç½®       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½å†å²æ•°æ®     â”‚ â† DataFeed å¤šæ—¶é—´å‘¨æœŸ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ä¸»å¾ªç¯ (æ¯æ ¹Kçº¿)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. æ„å»ºå¸‚åœºä¸Šä¸‹æ–‡              â”‚  â”‚
â”‚  â”‚    - å½“å‰ä»·æ ¼ã€æŒä»“ã€èµ„é‡‘      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. å†³ç­–è§¦å‘åˆ¤æ–­                â”‚  â”‚
â”‚  â”‚    - æŒ‰Næ ¹Kçº¿å‘¨æœŸè§¦å‘          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3. AI å†³ç­– (æˆ–ä½¿ç”¨ç¼“å­˜)        â”‚  â”‚
â”‚  â”‚    - è°ƒç”¨å†³ç­–å¼•æ“              â”‚  â”‚
â”‚  â”‚    - æ”¯æŒAIå†³ç­–ç¼“å­˜            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. è®¢å•æ‰§è¡Œæ¨¡æ‹Ÿ                â”‚  â”‚
â”‚  â”‚    - å¼€ä»“/å¹³ä»“                â”‚  â”‚
â”‚  â”‚    - æ»‘ç‚¹ä¸æ‰‹ç»­è´¹æ¨¡æ‹Ÿ          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5. æ¸…ç®—æ£€æŸ¥                    â”‚  â”‚
â”‚  â”‚    - å¼ºåˆ¶å¹³ä»“æ£€æµ‹              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 6. çŠ¶æ€æ›´æ–°ä¸æŒä¹…åŒ–            â”‚  â”‚
â”‚  â”‚    - æƒç›Šè®¡ç®—                  â”‚  â”‚
â”‚  â”‚    - æ£€æŸ¥ç‚¹ä¿å­˜                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ å›æµ‹å®Œæˆ/åœæ­¢     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ æ€§èƒ½æŒ‡æ ‡è®¡ç®—      â”‚ â† å¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ç­‰
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### AI å†³ç­–ç¼“å­˜æœºåˆ¶

```go
// AICache AI å†³ç­–ç¼“å­˜
type AICache struct {
    mu    sync.RWMutex
    cache map[string]*CacheEntry
}

type CacheEntry struct {
    PromptVariant string
    Timestamp     int64
    Decision      *decision.FullDecision
}

// ç¼“å­˜é”®è®¡ç®—: hash(prompt_variant + timestamp + market_data_hash)
// å¥½å¤„:
// 1. åŠ é€Ÿå›æµ‹é‡æ”¾
// 2. ä¿è¯ç›¸åŒæ¡ä»¶ç»“æœä¸€è‡´
// 3. å‡å°‘ AI API è°ƒç”¨æˆæœ¬
```

---

### 4.5 äº¤æ˜“æ‰§è¡Œå™¨æ¨¡å— (trader/)

**æ ¸å¿ƒæ–‡ä»¶**: `trader/auto_trader.go`

#### åŠŸèƒ½èŒè´£
- å®æ—¶å¸‚åœºæ•°æ®è®¢é˜…
- å®šæ—¶å†³ç­–è§¦å‘
- è®¢å•æ‰§è¡Œä¸ç®¡ç†
- ä»“ä½é£é™©ç®¡ç†
- WebSocket äº‹ä»¶æ¨é€

#### æ ¸å¿ƒç»“æ„

```go
// AutoTrader è‡ªåŠ¨äº¤æ˜“å™¨
type AutoTrader struct {
    cfg            *store.TraderConfig
    provider       provider.Provider
    strategyEngine *decision.StrategyEngine
    mcpClient      mcp.AIClient

    // çŠ¶æ€ç®¡ç†
    mu             sync.RWMutex
    status         TraderStatus
    lastDecisionAt time.Time

    // æ§åˆ¶é€šé“
    stopCh   chan struct{}
    doneCh   chan struct{}
}

// TraderStatus äº¤æ˜“å™¨çŠ¶æ€
type TraderStatus struct {
    State           string
    LastDecisionAt  *time.Time
    CurrentPrice    float64
    UnrealizedPnL   float64
    MarginUsedPct   float64
    OpenPositions   []provider.Position
}
```

#### äº¤æ˜“æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯åŠ¨è‡ªåŠ¨äº¤æ˜“     â”‚
â”‚ - è¿æ¥äº¤æ˜“æ‰€     â”‚
â”‚ - è®¢é˜…å¸‚åœºæ•°æ®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å®šæ—¶è§¦å‘å¾ªç¯ (æ¯Nåˆ†é’Ÿ)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. è·å–è´¦æˆ·ä¸æŒä»“çŠ¶æ€          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. æ„å»ºå†³ç­–ä¸Šä¸‹æ–‡              â”‚  â”‚
â”‚  â”‚    - å¸‚åœºæ•°æ®ã€é‡åŒ–æŒ‡æ ‡        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3. AI å†³ç­–                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. è®¢å•æ‰§è¡Œ                    â”‚  â”‚
â”‚  â”‚    - è®¡ç®—ä»“ä½å¤§å°              â”‚  â”‚
â”‚  â”‚    - è®¾ç½®æ­¢æŸ/æ­¢ç›ˆ            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5. WebSocket æ¨é€çŠ¶æ€         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ åœæ­¢/å¼‚å¸¸å¤„ç†     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.6 äº¤æ˜“æ‰€æä¾›å•†æ¨¡å— (provider/)

**æ ¸å¿ƒæ–‡ä»¶**: `provider/binance.go`

#### åŠŸèƒ½èŒè´£
- ç»Ÿä¸€äº¤æ˜“æ‰€æ¥å£æŠ½è±¡
- Binance æœŸè´§ API å®ç°
- è®¢å•ç®¡ç†
- è´¦æˆ·æŸ¥è¯¢
- WebSocket æ•°æ®æµ

#### æ¥å£å®šä¹‰

```go
// Provider äº¤æ˜“æ‰€æ¥å£
type Provider interface {
    // è´¦æˆ·
    GetAccount() (*Account, error)
    GetBalance() (map[string]interface{}, error)
    GetPositions() ([]Position, error)

    // å¸‚åœº
    GetMarketData(symbol string) (*MarketData, error)
    GetKlines(symbol, interval string, limit int) ([]Kline, error)

    // è®¢å•
    PlaceOrder(order *Order) (*OrderResult, error)
    CancelOrder(symbol, orderID string) error
    GetOpenOrders(symbol string) ([]Order, error)

    // WebSocket
    SubscribeKline(symbols []string, interval string, handler func(*KlineEvent))
    SubscribeUserData(handler func(*UserDataEvent))

    // å…³é—­
    Close()
}
```

---

### 4.7 æ•°æ®å­˜å‚¨æ¨¡å— (store/)

**æ ¸å¿ƒæ–‡ä»¶**: `store/store.go`

#### åŠŸèƒ½èŒè´£
- ç»Ÿä¸€æ•°æ®åº“è®¿é—®æ¥å£
- å­å­˜å‚¨æŒ‰é¢†åŸŸåˆ’åˆ†
- åŠ å¯†æ”¯æŒ (API Key)
- äº‹åŠ¡ç®¡ç†
- æ•°æ®è¿ç§»

#### å­˜å‚¨ç»“æ„

```go
// Store ç»Ÿä¸€å­˜å‚¨æ¥å£
type Store struct {
    db *sql.DB

    // å­å­˜å‚¨ (æ‡’åŠ è½½)
    user     *UserStore
    aiModel  *AIModelStore
    exchange *ExchangeStore
    trader   *TraderStore
    decision *DecisionStore
    backtest *BacktestStore
    position *PositionStore
    strategy *StrategyStore
    equity   *EquityStore
    order    *OrderStore

    // åŠ å¯†å‡½æ•°
    encryptFunc func(string) string
    decryptFunc func(string) string
}
```

#### æ•°æ®è¡¨è®¾è®¡

| è¡¨å | ç”¨é€” | å…³é”®å­—æ®µ |
|------|------|----------|
| `users` | ç”¨æˆ·ä¿¡æ¯ | id, username, password_hash |
| `ai_models` | AI æ¨¡å‹é…ç½® | id, user_id, provider, api_key (åŠ å¯†) |
| `exchanges` | äº¤æ˜“æ‰€é…ç½® | id, user_id, name, api_key/api_secret (åŠ å¯†) |
| `strategies` | ç­–ç•¥é…ç½® | id, user_id, name, config (JSON) |
| `traders` | äº¤æ˜“å‘˜é…ç½® | id, user_id, strategy_id, exchange_id |
| `debate_sessions` | AI è¾©è®ºä¼šè¯ | id, user_id, strategy_id, status |
| `debate_participants` | è¾©è®ºå‚ä¸è€… | id, session_id, ai_model_id, personality |
| `debate_messages` | è¾©è®ºæ¶ˆæ¯ | id, session_id, round, content, decision (JSON) |
| `debate_votes` | è¾©è®ºæŠ•ç¥¨ | id, session_id, ai_model_id, decisions (JSON) |
| `backtests` | å›æµ‹è®°å½• | id, user_id, strategy_id, status |
| `trader_equity_snapshots` | è´¦æˆ·æƒç›Šå¿«ç…§ | id, trader_id, timestamp, equity |
| `positions` | æŒä»“è®°å½• | id, trader_id, symbol, side, quantity |

---

### 4.8 å¸‚åœºæ•°æ®æ¨¡å— (market/)

**åŠŸèƒ½èŒè´£**
- Kçº¿æ•°æ®è·å–
- æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
- å¤šæ—¶é—´å‘¨æœŸæ•°æ®åˆå¹¶
- é‡åŒ–æ•°æ®æ¥å£

---

### 4.9 MCP æ¨¡å— (mcp/)

**åŠŸèƒ½èŒè´£**
- ç»Ÿä¸€ AI æ¨¡å‹å®¢æˆ·ç«¯æ¥å£
- æ”¯æŒå¤šç§ AI æä¾›å•†
- è‡ªå®šä¹‰ API URL æ”¯æŒ
- æµå¼å“åº”æ”¯æŒ

```go
// AIClient AI å®¢æˆ·ç«¯æ¥å£
type AIClient interface {
    CallWithMessages(systemPrompt, userPrompt string) (string, error)
    SetAPIKey(apiKey, customURL, customModel string)
}

// æ”¯æŒçš„æä¾›å•†
func New() AIClient           // é»˜è®¤
func NewDeepSeekClient() AIClient
func NewQwenClient() AIClient
func NewOpenAIClient() AIClient
func NewClaudeClient() AIClient
func NewGeminiClient() AIClient
func NewGrokClient() AIClient
func NewKimiClient() AIClient
```

---

## 5. æ•°æ®æµä¸ä¸šåŠ¡æµç¨‹

### 5.1 ç”¨æˆ·è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    POST /api/auth/register    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   API   â”‚
â”‚         â”‚                                â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
         è¿”å› JWT Token                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  Store  â”‚
                                          â”‚ (users) â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç­–ç•¥é…ç½®ä¸å›æµ‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·   â”‚ åˆ›å»ºç­–ç•¥é…ç½®          â”‚  API    â”‚
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   å¯åŠ¨å›æµ‹              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚Backtest â”‚
â”‚         â”‚                        â”‚ Engine  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<â”€ SSE æ¨é€å›æµ‹è¿›åº¦ â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                 â–¼
         â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚ Decision â”‚
         â”‚                           â”‚ Engine  â”‚
         â”‚                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                                â”‚
         â”‚                                â–¼
         â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚   MCP   â”‚
         â”‚                           â”‚  (AI)   â”‚
         â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                 â”‚
         â–¼                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Store  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Market  â”‚
    â”‚ (å›æµ‹)   â”‚     è·å–å†å²æ•°æ®      â”‚ Data    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 AI è¾©è®ºæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   åˆ›å»ºè¾©è®ºä¼šè¯           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  API    â”‚
â”‚         â”‚                        â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<â”€ SSE æ¨é€è¾©è®ºè¿‡ç¨‹ â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ Debate  â”‚
                                      â”‚ Engine  â”‚
                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                 â”‚
         â–¼                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   å¤šè½®è¾©è®º + æŠ•ç¥¨     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MCP    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚Strategy â”‚
    â”‚ (å¤šAI)  â”‚                      â”‚ Engine  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Store  â”‚ ä¿å­˜è¾©è®ºè®°å½•
    â”‚ (debate)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 å®æ—¶äº¤æ˜“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   å¯åŠ¨äº¤æ˜“å‘˜             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Manager â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ Trader  â”‚
                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                        â”‚
         â–¼                                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Providerâ”‚<â”€ WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Binance â”‚
    â”‚         â”‚   (Kçº¿ + ç”¨æˆ·æ•°æ®)         â”‚  API    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Decisionâ”‚ å®šæ—¶è§¦å‘å†³ç­–
    â”‚ Engine  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MCP   â”‚ AI å†³ç­–
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Providerâ”‚ æ‰§è¡Œè®¢å•
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Store  â”‚ è®°å½•äº¤æ˜“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ

### 6.1 ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼

| æ¨¡å¼ | åº”ç”¨åœºæ™¯ | ç¤ºä¾‹ä½ç½® |
|------|---------|---------|
| **ä¾èµ–æ³¨å…¥ (DI)** | Serverã€å„å¼•æ“æ„é€ å‡½æ•° | `api/server.go`, `debate/engine.go` |
| **å·¥å‚æ¨¡å¼** | AI å®¢æˆ·ç«¯åˆ›å»º | `mcp/` åŒ… |
| **ç­–ç•¥æ¨¡å¼** | äº¤æ˜“æ‰€æä¾›å•†æŠ½è±¡ | `provider/` åŒ… |
| **å­˜å‚¨åº“æ¨¡å¼** | æ•°æ®è®¿é—®å°è£… | `store/` åŒ… |
| **è§‚å¯Ÿè€…æ¨¡å¼** | SSE äº‹ä»¶æ¨é€ | `debate/engine.go` å›è°ƒå‡½æ•° |
| **å•ä¾‹æ¨¡å¼** | å…¨å±€é…ç½® | `config/` åŒ… |
| **ä¸­é—´ä»¶æ¨¡å¼** | API è®¤è¯ä¸æ—¥å¿— | `api/server.go` Gin ä¸­é—´ä»¶ |
| **å»ºé€ è€…æ¨¡å¼** | æç¤ºè¯æ„å»º | `decision/engine.go` |
| **çŠ¶æ€æ¨¡å¼** | å›æµ‹è¿è¡ŒçŠ¶æ€ | `backtest/runner.go` |
| **å‘½ä»¤æ¨¡å¼** | å›æµ‹æ§åˆ¶ (æš‚åœ/æ¢å¤/åœæ­¢) | `backtest/runner.go` |

### 6.2 å¹¶å‘æ§åˆ¶

```go
// 1. è¯»å†™é”ä¿æŠ¤å…±äº«çŠ¶æ€
type Store struct {
    mu sync.RWMutex
    // ...
}

// 2. é€šé“æ§åˆ¶ goroutine
type Runner struct {
    pauseCh  chan struct{}
    resumeCh chan struct{}
    stopCh   chan struct{}
    doneCh   chan struct{}
}

// 3. WaitGroup ç­‰å¾…ä¸€ç»„ä»»åŠ¡
var wg sync.WaitGroup
for _, symbol := range symbols {
    wg.Add(1)
    go func(sym string) {
        defer wg.Done()
        // å¤„ç† symbol
    }(symbol)
}
wg.Wait()

// 4. Context ä¼ æ’­å–æ¶ˆä¿¡å·
func (r *Runner) Start(ctx context.Context) error {
    go r.loop(ctx)
    return nil
}
```

### 6.3 é”™è¯¯å¤„ç†

```go
// 1. è‡ªå®šä¹‰é”™è¯¯ç±»å‹
var (
    errBacktestCompleted = errors.New("backtest completed")
    errLiquidated        = errors.New("account liquidated")
)

// 2. é”™è¯¯åŒ…è£…
return fmt.Errorf("failed to open database: %w", err)

// 3. é”™è¯¯æ£€æŸ¥ä¸æ—¥å¿—
if err != nil {
    logger.Errorf("Failed to save message: %v", err)
    // ç»§ç»­å¤„ç†æˆ–è¿”å›
}
```

### 6.4 é…ç½®ç®¡ç†

```go
// 1. ç¯å¢ƒå˜é‡åŠ è½½
func Init() {
    cfg := &Config{
        APIServerPort: 8080,
        // é»˜è®¤å€¼
    }

    // ä»ç¯å¢ƒå˜é‡è¦†ç›–
    if v := os.Getenv("JWT_SECRET"); v != "" {
        cfg.JWTSecret = v
    }
    // ...
}

// 2. ç­–ç•¥é…ç½® JSON åºåˆ—åŒ–
type StrategyConfig struct {
    Symbols        []string          `json:"symbols"`
    Indicators     IndicatorConfig   `json:"indicators"`
    Risk           RiskConfig        `json:"risk"`
}

func (s *Strategy) ParseConfig() (*StrategyConfig, error) {
    var cfg StrategyConfig
    if err := json.Unmarshal([]byte(s.ConfigJSON), &cfg); err != nil {
        return nil, err
    }
    return &cfg, nil
}
```

### 6.5 èµ„æºç®¡ç†

```go
// 1. defer ç¡®ä¿èµ„æºé‡Šæ”¾
func (s *Store) Close() error {
    return s.db.Close()
}

// 2. ä½¿ç”¨ context è¶…æ—¶æ§åˆ¶
ctx, cancel := context.WithTimeout(context.Background(), 60*time.Second)
defer cancel()

// 3. è¿æ¥æ± é…ç½®
db.SetMaxOpenConns(1)     // SQLite å•è¿æ¥
db.SetMaxIdleConns(1)
```

---

## 7. å®‰å…¨æœºåˆ¶

### 7.1 è®¤è¯ä¸æˆæƒ

```go
// JWT è®¤è¯ä¸­é—´ä»¶
func authMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        token := c.GetHeader("Authorization")
        if token == "" {
            c.AbortWithStatusJSON(401, gin.H{"error": "missing token"})
            return
        }

        claims, err := validateJWT(token)
        if err != nil {
            c.AbortWithStatusJSON(401, gin.H{"error": "invalid token"})
            return
        }

        c.Set("userID", claims.UserID)
        c.Next()
    }
}
```

### 7.2 æ•æ„Ÿæ•°æ®åŠ å¯†

```go
// API Key åŠ å¯†å­˜å‚¨
type Store struct {
    encryptFunc func(string) string
    decryptFunc func(string) string
}

func (s *Store) SetCryptoFuncs(encrypt, decrypt func(string) string) {
    s.encryptFunc = encrypt
    s.decryptFunc = decrypt
}

// ä½¿ç”¨æ—¶è§£å¯†
func (m *AIModelStore) GetByID(id string) (*store.AIModel, error) {
    model := &store.AIModel{...}
    if s.decryptFunc != nil {
        model.APIKey = s.decryptFunc(model.APIKey)
    }
    return model, nil
}
```

### 7.3 ä¼ è¾“åŠ å¯†é…ç½®

```go
// config/config.go
type Config struct {
    // ä¼ è¾“åŠ å¯†: æµè§ˆå™¨ç«¯åŠ å¯† API Key
    // éœ€è¦ HTTPS æˆ– localhost
    TransportEncryption bool
}

// å‰ç«¯æ ¹æ®æ­¤é…ç½®å†³å®šæ˜¯å¦åŠ å¯† API Key
```

### 7.4 CORS é…ç½®

```go
// api/server.go
router.Use(cors.New(cors.Config{
    AllowOrigins:     []string{"*"},
    AllowMethods:     []string{"GET", "POST", "PUT", "DELETE"},
    AllowHeaders:     []string{"Origin", "Content-Type", "Authorization"},
    ExposeHeaders:    []string{"Content-Length"},
    AllowCredentials: true,
}))
```

---

## 8. æ€§èƒ½ä¸å¯æ‰©å±•æ€§

### 8.1 æ€§èƒ½ä¼˜åŒ–æªæ–½

| ä¼˜åŒ–é¡¹ | å®ç°æ–¹å¼ | æ•ˆæœ |
|--------|---------|------|
| **AI å†³ç­–ç¼“å­˜** | å›æµ‹æ—¶ç¼“å­˜ AI å“åº” | å¤§å¹…åŠ é€Ÿé‡å¤å›æµ‹ |
| **è¿æ¥æ± ** | æ•°æ®åº“è¿æ¥å¤ç”¨ | å‡å°‘è¿æ¥å¼€é”€ |
| **æ‡’åŠ è½½** | å­å­˜å‚¨æŒ‰éœ€åˆå§‹åŒ– | å‡å°‘å†…å­˜å ç”¨ |
| **æ‰¹é‡æŸ¥è¯¢** | Kçº¿æ•°æ®æ‰¹é‡è·å– | å‡å°‘ç½‘ç»œè¯·æ±‚ |
| **WebSocket** | å®æ—¶æ•°æ®æ¨é€ | å‡å°‘è½®è¯¢å¼€é”€ |
| **æ£€æŸ¥ç‚¹æœºåˆ¶** | å›æµ‹çŠ¶æ€å®šæœŸä¿å­˜ | æ”¯æŒæ–­ç‚¹ç»­ä¼  |

### 8.2 å¯æ‰©å±•æ€§è®¾è®¡

1. **äº¤æ˜“æ‰€æ‰©å±•**: å®ç° `Provider` æ¥å£å³å¯æ·»åŠ æ–°äº¤æ˜“æ‰€
2. **AI æ¨¡å‹æ‰©å±•**: å®ç° `AIClient` æ¥å£å³å¯æ·»åŠ æ–° AI æä¾›å•†
3. **ç­–ç•¥æ‰©å±•**: é€šè¿‡ `StrategyConfig` JSON é…ç½®å®šä¹‰æ–°ç­–ç•¥
4. **æŒ‡æ ‡æ‰©å±•**: åœ¨ `decision/indicators.go` æ·»åŠ æ–°æŒ‡æ ‡è®¡ç®—

### 8.3 æ°´å¹³æ‰©å±•è€ƒè™‘

- å½“å‰æ¶æ„ä¸ºå•æœºéƒ¨ç½²
- SQLite å¯æ›¿æ¢ä¸º PostgreSQL/MySQL æ”¯æŒåˆ†å¸ƒå¼
- å¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦å†³ç­–ä¸æ‰§è¡Œ
- å›æµ‹ä»»åŠ¡å¯åˆ†å‘åˆ°å·¥ä½œèŠ‚ç‚¹

---

## 9. éƒ¨ç½²ä¸è¿ç»´

### 9.1 æ„å»ºé…ç½®

```makefile
# Makefile
.PHONY: build run clean

build:
    cd web && npm run build
    go build -o nofx main.go

run:
    go run main.go

clean:
    rm -f nofx
    rm -rf web/dist

docker:
    docker build -t nofx:latest .
```

### 9.2 ç¯å¢ƒå˜é‡

```bash
# .env.example
JWT_SECRET=your-secret-key-change-in-production
REGISTRATION_ENABLED=true
MAX_USERS=10
API_SERVER_PORT=8080
TRANSPORT_ENCRYPTION=false
EXPERIENCE_IMPROVEMENT=true
```

### 9.3 Docker éƒ¨ç½²

```dockerfile
# Dockerfile (æ¨æµ‹)
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY . .
RUN cd web && npm install && npm run build
RUN go build -o nofx main.go

FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/nofx .
COPY --from=builder /app/web/dist ./web/dist
EXPOSE 8080
CMD ["./nofx"]
```

### 9.4 æ—¥å¿—ä¸ç›‘æ§

```go
// logger/logger.go
func Infof(format string, args ...interface{})
func Warnf(format string, args ...interface{})
func Errorf(format string, args ...interface{})

// ä½¿ç”¨ç¤ºä¾‹
logger.Infof("âœ… Database enabled DELETE mode and FULL sync")
logger.Warnf("Failed to migrate equity data: %v", err)
logger.Errorf("Debate panic recovered: %v", r)
```

---

## 10. æ€»ç»“ä¸å»ºè®®

### 10.1 é¡¹ç›®ä¼˜åŠ¿

1. **æ¶æ„æ¸…æ™°**: åˆ†å±‚æ˜ç¡®ï¼Œæ¨¡å—èŒè´£å•ä¸€
2. **æŠ€æœ¯æ ˆç°ä»£**: Go + React + TypeScriptï¼Œå¼€å‘æ•ˆç‡é«˜
3. **AI é›†æˆå®Œå–„**: æ”¯æŒå¤šç§ AI æä¾›å•†ï¼Œç»Ÿä¸€ MCP æ¥å£
4. **åˆ›æ–°åŠŸèƒ½**: AI è¾©è®ºæœºåˆ¶ç‹¬ç‰¹ï¼Œå¤šæ™ºèƒ½ä½“å†³ç­–å¢å¼ºé²æ£’æ€§
5. **å›æµ‹åŠŸèƒ½å®Œæ•´**: æ”¯æŒæ£€æŸ¥ç‚¹ã€ç¼“å­˜ã€å¤šæ—¶é—´å‘¨æœŸ
6. **å®‰å…¨è€ƒè™‘**: API Key åŠ å¯†ã€JWT è®¤è¯ã€ä¼ è¾“åŠ å¯†å¯é€‰

### 10.2 æ”¹è¿›å»ºè®®

#### çŸ­æœŸæ”¹è¿›
1. **å•å…ƒæµ‹è¯•è¦†ç›–**: å½“å‰æœªè§æµ‹è¯•æ–‡ä»¶ï¼Œå»ºè®®æ·»åŠ å…³é”®æ¨¡å—æµ‹è¯•
2. **é…ç½®éªŒè¯**: æ·»åŠ ç­–ç•¥é…ç½®çš„ç»“æ„åŒ–éªŒè¯
3. **é”™è¯¯æ¢å¤**: å¢åŠ æ›´å®Œå–„çš„é”™è¯¯é‡è¯•æœºåˆ¶
4. **æ—¥å¿—ç»“æ„åŒ–**: ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ä¾¿äºæŸ¥è¯¢åˆ†æ

#### ä¸­æœŸæ”¹è¿›
1. **æ•°æ®åº“è¿ç§»**: è€ƒè™‘æ”¯æŒ PostgreSQL å¤„ç†é«˜å¹¶å‘
2. **æ¶ˆæ¯é˜Ÿåˆ—**: å¼•å…¥ Redis/RabbitMQ è§£è€¦ç»„ä»¶
3. **ç›‘æ§å‘Šè­¦**: é›†æˆ Prometheus + Grafana
4. **API æ–‡æ¡£**: ä½¿ç”¨ Swagger/OpenAPI è§„èŒƒ

#### é•¿æœŸæ”¹è¿›
1. **åˆ†å¸ƒå¼å›æµ‹**: æ”¯æŒå¤šèŠ‚ç‚¹å¹¶è¡Œå›æµ‹
2. **ç­–ç•¥å¸‚åœº**: å…è®¸ç”¨æˆ·åˆ†äº«å’Œäº¤æ˜“ç­–ç•¥
3. **ç§»åŠ¨ç«¯**: å¼€å‘ç§»åŠ¨ App
4. **å¤šè¯­è¨€æ”¯æŒ**: å›½é™…åŒ– i18n

### 10.3 æ½œåœ¨é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| AI API ç¨³å®šæ€§ | å†³ç­–å¤±è´¥ | é‡è¯•æœºåˆ¶ + é™çº§ç­–ç•¥ |
| äº¤æ˜“æ‰€é™åˆ¶ | äº¤æ˜“å—é™ | å¤šäº¤æ˜“æ‰€æ”¯æŒ + é™æµæ§åˆ¶ |
| å¸‚åœºæ³¢åŠ¨ | èµ„é‡‘æŸå¤± | ä¸¥æ ¼æ­¢æŸ + é£é™©æ§åˆ¶ |
| æ•°æ®å®‰å…¨ | ä¿¡æ¯æ³„éœ² | åŠ å¯†å­˜å‚¨ + HTTPS |

---

## é™„å½•

### A. å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½æè¿° |
|---------|---------|
| `main.go` | ç¨‹åºå…¥å£ |
| `api/server.go` | API æœåŠ¡ |
| `store/store.go` | æ•°æ®å­˜å‚¨ |
| `decision/engine.go` | å†³ç­–å¼•æ“ |
| `debate/engine.go` | AI è¾©è®ºå¼•æ“ |
| `backtest/runner.go` | å›æµ‹å¼•æ“ |
| `trader/auto_trader.go` | è‡ªåŠ¨äº¤æ˜“å™¨ |
| `manager/trader_manager.go` | äº¤æ˜“ç®¡ç†å™¨ |
| `provider/binance.go` | Binance æä¾›å•† |
| `config/config.go` | å…¨å±€é…ç½® |

### B. æ•°æ®åº“è¡¨å…³ç³»å›¾

```
users (1) ----< (N) ai_models
  |
  | (1) ----< (N) exchanges
  |
  | (1) ----< (N) strategies
  |              |
  |              | (1) ----< (N) traders
  |              |              |
  |              |              | (1) ----< (N) trader_equity_snapshots
  |              |
  |              | (1) ----< (N) debate_sessions
  |                             |
  |                             | (1) ----< (N) debate_participants
  |                             |              |
  |                             |              | (1) ----< (N) debate_messages
  |                             |              |
  |                             |              | (1) ----< (N) debate_votes
  |
  | (1) ----< (N) backtests
```

### C. API ç«¯ç‚¹æ‘˜è¦

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/auth/register` | POST | ç”¨æˆ·æ³¨å†Œ |
| `/api/auth/login` | POST | ç”¨æˆ·ç™»å½• |
| `/api/users/me` | GET | è·å–å½“å‰ç”¨æˆ· |
| `/api/strategies` | POST/GET | åˆ›å»º/è·å–ç­–ç•¥ |
| `/api/traders` | POST/GET | åˆ›å»º/è·å–äº¤æ˜“å‘˜ |
| `/api/traders/:id/start` | POST | å¯åŠ¨äº¤æ˜“ |
| `/api/traders/:id/stop` | POST | åœæ­¢äº¤æ˜“ |
| `/api/backtests` | POST/GET | åˆ›å»º/è·å–å›æµ‹ |
| `/api/backtests/:id/start` | POST | å¯åŠ¨å›æµ‹ |
| `/api/debates` | POST/GET | åˆ›å»º/è·å–è¾©è®º |
| `/api/debates/:id/start` | POST | å¯åŠ¨è¾©è®º |
| `/api/debates/:id/stream` | GET | SSE è¾©è®ºæµ |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-28

**åˆ†æå·¥å…·**: Claude Code

**é¡¹ç›®è·¯å¾„**: `/home/zcxggmu/workspace/hello-projs/posp/trading/nofx`

**æŠ¥å‘Šç‰ˆæœ¬**: 1.0
