# A股/港股 融合交易平台技术方案与开发路线规划

> 基于当前路径下两份分析报告：
> - `NOFX_技术分析报告.md`（交易执行/策略/回测一体化架构）
> - `TradingAgents-CN_技术分析报告.md`（多智能体分析平台架构）
>
> 目标：融合两者优势，使用 **Python** 构建面向 **A股/港股** 的分析与交易系统（非加密货币）。

---

## 1. 目标与边界

### 1.1 目标
- 建立 **多智能体分析 + 可配置策略 + 回测 + 实盘交易** 的统一系统。
- 覆盖 **A股** 与 **港股** 数据与交易规则。
- 提供 **API + Web UI**（可先做 API，UI 后续迭代）。

### 1.2 非目标（初期）
- 不做高频/超低延迟撮合。
- 不直接提供券商资质或清算服务。
- 不承诺收益或投资建议。

---

## 2. 核心理念：NOFX + TradingAgents-CN 融合

| 维度 | NOFX 优势（可复用思路） | TradingAgents-CN 优势（可复用思路） | 融合策略 |
|---|---|---|---|
| 架构形态 | 一体化交易执行/回测/策略引擎 | 多智能体分析、LangGraph 编排 | Python 单体核心 + 可扩展服务化
| 风控体系 | 决策校验、仓位/杠杆/风报比 | 分析层多维判断 | 分析层建议 + 执行层硬风控
| 数据层 | 实时行情/指标/仓位跟踪 | 多源数据融合（A/HK/美股） | 统一市场数据与公司基本面
| 执行层 | Trader 接口、多交易所适配 | 主要为分析平台 | 定义 Broker 接口 + 券商适配插件
| 回测 | 数据馈送/决策回放/结果存储 | 研究与报告型输出 | 高一致性的回测-实盘框架
| 安全 | API Key 加密、传输加密 | 认证/缓存/任务调度 | 统一安全与密钥管理

---

## 3. 总体架构（Python 版本）

```
┌──────────────────────────────────────────────────────────────┐
│                           Web UI                             │
│   前端（Vue/React 可选） / 管理台 / 策略编辑 / 回测展示       │
└───────────────┬──────────────────────────────────────────────┘
                │ HTTPS / WebSocket / SSE
┌───────────────▼──────────────────────────────────────────────┐
│                         API 网关层                            │
│                      FastAPI + Uvicorn                        │
│  认证 | 速率限制 | 日志 | 配置 | WebSocket/SSE                │
└───────────────┬──────────────────────────────────────────────┘
                │
┌───────────────▼──────────────────────────────────────────────┐
│                      业务核心层（Python）                     │
│  1) 多智能体分析 (LangGraph)                                  │
│  2) 策略/决策引擎（结构化决策 + 校验）                         │
│  3) 交易执行引擎（订单路由/撮合/风控）                         │
│  4) 回测引擎（历史数据 + 账户/订单模拟）                       │
│  5) 投资组合与风险监控                                         │
└───────────────┬──────────────────────────────────────────────┘
                │
┌───────────────▼──────────────────────────────────────────────┐
│                     数据访问与缓存层                          │
│  数据源适配器：AKShare / Tushare / BaoStock / YFinance         │
│  基本面/新闻/公告/宏观数据                                    │
└───────────────┬──────────────────────────────────────────────┘
                │
┌───────────────▼──────────────────────────────────────────────┐
│                     存储层与队列                              │
│  PostgreSQL/MongoDB(分析结果) + Redis(缓存/任务) + 文件存储     │
└───────────────┬──────────────────────────────────────────────┘
                │
┌───────────────▼──────────────────────────────────────────────┐
│                    券商/交易接入层（Broker）                   │
│  IBKR / Futu OpenD / Tiger / QMT / XTP 等插件式适配            │
└──────────────────────────────────────────────────────────────┘
```

---

## 4. A股/港股差异与系统适配

### 4.1 交易规则差异
- **A股**
  - T+1 交割（多数股票），涨跌幅限制（主板 10%，科创/创业板 20%）。
  - 交易单位 100 股（1 手）。
  - 停牌、除权除息影响显著。
- **港股**
  - 无涨跌停限制（但有波动机制）。
  - 每只股票有最小买卖单位（Board Lot）。
  - 支持日内买卖，结算一般 T+2。

### 4.2 系统适配要点
- 交易日历：交易时段、节假日、午间休市。
- 复权处理：前复权/后复权，需统一回测与实盘逻辑。
- 公司行为：分红、送股、拆合股影响策略。
- 成交成本模型：A/HK 各自费率结构（佣金/印花税/平台费）。

---

## 5. 功能模块设计（Python）

### 5.1 多智能体分析层（TradingAgents-CN 精髓）

**建议的 Agent 角色：**
- 市场情绪 Agent（新闻/舆情/社交）
- 基本面 Agent（财报、估值、行业）
- 技术面 Agent（趋势、形态、指标）
- 风险控制 Agent（波动、回撤、仓位）
- 投资组合经理 Agent（权重建议、资产分配）
- 执行规划 Agent（订单拆分、交易时机）

**编排方式：**
- LangGraph 状态机，输出结构化决策 JSON。

### 5.2 决策与风控层（NOFX 精髓）

- 统一 `DecisionSchema`：
  - `symbol`、`action`（buy/sell/hold）、`size`、`price_limit`、`stop_loss`、`take_profit`、`confidence`。
- 校验规则（硬风控）：
  - 最大仓位比例、最大回撤、单笔亏损阈值。
  - A股涨跌停/停牌限制。
  - 港股最小买卖单位校验。

### 5.3 交易执行层

- 统一 Broker 接口：
  - `place_order()` / `cancel_order()` / `get_positions()` / `get_account()`。
- 支持多券商适配（插件式）。
- 支持仿真交易（paper trading）作为默认实现。

### 5.4 回测引擎

- 历史数据馈送（多周期、多资产）。
- 成本模型（交易成本、滑点、税费）。
- 支持回测结果存储 + 绩效指标（Sharpe、MaxDD）。

### 5.5 数据源层

- A股：AKShare / Tushare / BaoStock。
- 港股：AKShare HK / YFinance / 券商行情。
- 基本面：财报、估值、行业数据。
- 新闻舆情：公开新闻 API + RSS。

### 5.6 存储与缓存

- Redis：任务/会话/短期缓存。
- MongoDB/PostgreSQL：分析结果、回测记录、策略版本。
- 文件存储：报告导出、日志。

---

## 6. 技术选型建议（Python）

| 层次 | 推荐技术 | 说明 |
|---|---|---|
| Web/API | FastAPI + Uvicorn | 高性能异步 API
| Agent | LangGraph + LangChain | 多智能体编排
| 数据 | AKShare/Tushare/YFinance | A股/港股数据源
| 回测 | 自研 or Backtrader | 建议与实盘统一数据结构
| 存储 | MongoDB/PostgreSQL | 结果/配置持久化
| 缓存 | Redis | 任务进度/会话
| 认证 | JWT + bcrypt | 用户管理
| 部署 | Docker + Compose | 可扩展部署

---

## 7. 关键流程（示意）

### 7.1 分析与下单流程
1. 用户选择股票池与策略参数。
2. Agent 分析 → 输出结构化决策。
3. 决策引擎校验（风控）。
4. 交易执行层下单。
5. 订单/仓位持久化。

### 7.2 回测流程
1. 输入策略 + 时间区间。
2. 拉取历史数据 → 时间推进。
3. AI/规则决策 → 模拟交易。
4. 输出绩效指标、权益曲线、交易明细。

---

## 8. 开发路线规划（阶段化）

### Phase 0：准备期（1-2 周）
- 明确市场范围（A股/港股）与数据源授权。
- 完成系统基础架构搭建（FastAPI + Redis + Mongo/PostgreSQL）。
- 定义统一数据模型（行情/订单/仓位/决策）。

### Phase 1：分析系统 MVP（3-4 周）
- 集成 TradingAgents-CN 多智能体分析框架。
- 完成股票基础数据拉取（A股 + 港股）。
- 输出结构化“分析报告 + 交易建议”。

**交付物：**
- API `POST /analysis/run` 返回报告与建议。

### Phase 2：交易模拟与回测（4-6 周）
- 构建基础回测引擎（事件驱动）。
- 支持策略版本化与结果存储。
- 生成权益曲线与绩效指标。

**交付物：**
- API `POST /backtest/start`，可查询结果。

### Phase 3：实盘交易（6-8 周）
- 定义 Broker 插件接口。
- 接入 1-2 家券商（优先：IBKR / Futu）。
- 支持 Paper Trading 与 Sandbox。

**交付物：**
- API `POST /trade/execute` 触发实盘订单。

### Phase 4：可视化与运营平台（4-6 周）
- 前端策略管理、回测结果展示。
- 账户/仓位实时监控。
- 风险告警与通知系统。

---

## 9. 风险与合规注意事项

- **市场准入**：A股实盘需券商授权接口（QMT/XTP 等）。
- **交易合规**：注意监管规则、数据授权与用户风险提示。
- **数据质量**：复权、停牌、异常行情处理是关键。
- **模型风险**：AI 决策必须受硬风控约束。

---

## 10. 结论

结合 NOFX 的“执行/回测/风控一体化”与 TradingAgents-CN 的“多智能体分析编排”，可以在 Python 生态下构建一个面向 A股/港股的专业分析与交易系统。

**推荐路径：先分析与回测，再接入实盘券商。**

---

